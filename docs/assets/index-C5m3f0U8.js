(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))i(n);new MutationObserver(n=>{for(const s of n)if(s.type==="childList")for(const r of s.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&i(r)}).observe(document,{childList:!0,subtree:!0});function e(n){const s={};return n.integrity&&(s.integrity=n.integrity),n.referrerPolicy&&(s.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?s.credentials="include":n.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function i(n){if(n.ep)return;n.ep=!0;const s=e(n);fetch(n.href,s)}})();const ft={defaultColumnWidth:150,defaultRowHeight:30,minColumnWidth:50,maxColumnWidth:500,minRowHeight:20,maxRowHeight:150,headerHeight:35,rowNumberWidth:50,font:"14px Inter, sans-serif",headerFont:"bold 14px Inter, sans-serif",padding:5,textAlign:"left",textBaseline:"middle",textColor:"#111827",placeholderTextColor:"#9ca3af",loadingTextColor:"#3b82f6",errorTextColor:"#b91c1c",cellBgColor:"#ffffff",activeCellBgColor:"#eff6ff",errorCellBgColor:"#fca5a5",selectedRowBgColor:"#f3f4f6",selectedRangeBgColor:"#e0e7ff",headerTextColor:"#ffffff",selectedHeaderTextColor:"#000000",headerBgColor:"#4b5563",customHeaderBgColor:"#9ca3af",selectedHeaderBgColor:"#dbeafe",headerClipText:!0,headerTextAlign:"center",gridLineColor:"#d1d5db",rowNumberBgColor:"#f3f4f6",selectedRowNumberBgColor:"#dbeafe",disabledCellBgColor:"#e5e7eb",disabledCellTextColor:"#9ca3af",highlightBorderColor:"#3b82f6",fillHandleColor:"#3b82f6",fillHandleSize:10,dragRangeBorderColor:"#6b7280",copyHighlightBorderColor:"#1f2937",copyHighlightBorderDash:[4,3],resizeHandleSize:5,verbose:!1},X="disabled:";class pt{constructor(t){this.systemScrollbarWidth=0,this.container=t,this.container.style.position="relative",this.container.tabIndex=-1,this.systemScrollbarWidth=this.getSystemScrollbarWidth()+1,this.canvas=document.createElement("canvas");const e=this.canvas.getContext("2d");if(!e)throw new Error("Failed to get 2D context from canvas");this.ctx=e,this.container.appendChild(this.canvas),this.hScrollbar=document.createElement("div"),this.hScrollbar.id="spreadsheet-hscrollbar",this.hScrollbar.style.position="absolute",this.hScrollbar.style.bottom="0",this.hScrollbar.style.left="0",this.hScrollbar.style.width=`calc(100% - ${this.systemScrollbarWidth}px)`,this.hScrollbar.style.overflow="auto",this.container.appendChild(this.hScrollbar),this.vScrollbar=document.createElement("div"),this.vScrollbar.id="spreadsheet-vscrollbar",this.vScrollbar.style.position="absolute",this.vScrollbar.style.right="0",this.vScrollbar.style.top="0",this.vScrollbar.style.width=`${this.systemScrollbarWidth}px`,this.vScrollbar.style.height=`calc(100% - ${this.systemScrollbarWidth}px)`,this.vScrollbar.style.overflow="auto",this.container.appendChild(this.vScrollbar),this.editorInput=document.createElement("input"),this.editorInput.className="spreadsheet-editor",this.editorInput.style.position="absolute",this.editorInput.style.display="none",this.editorInput.style.boxSizing="border-box",this.container.appendChild(this.editorInput),this.dropdown=document.createElement("div"),this.dropdown.className="spreadsheet-dropdown",this.dropdown.style.position="absolute",this.dropdown.style.display="none",this.dropdown.style.zIndex="100",this.dropdown.style.border="1px solid #ccc",this.dropdown.style.backgroundColor="white",this.dropdown.style.boxShadow="0 2px 5px rgba(0,0,0,0.15)";const i=document.createElement("div");i.className="spreadsheet-dropdown-search",i.style.padding="5px",i.style.borderBottom="1px solid #eee",this.dropdownSearchInput=document.createElement("input"),this.dropdownSearchInput.type="text",this.dropdownSearchInput.placeholder="Search...",this.dropdownSearchInput.style.width="100%",this.dropdownSearchInput.style.boxSizing="border-box",this.dropdownSearchInput.style.padding="4px",i.appendChild(this.dropdownSearchInput),this.dropdownList=document.createElement("ul"),this.dropdownList.className="spreadsheet-dropdown-list",this.dropdownList.style.listStyle="none",this.dropdownList.style.margin="0",this.dropdownList.style.padding="0",this.dropdownList.style.maxHeight="200px",this.dropdownList.style.overflowY="auto",this.dropdown.appendChild(i),this.dropdown.appendChild(this.dropdownList),this.container.appendChild(this.dropdown)}getSystemScrollbarWidth(){var n;if(this.systemScrollbarWidth)return this.systemScrollbarWidth;const t=document.createElement("div");t.style.visibility="hidden",t.style.overflow="scroll",document.body.appendChild(t);const e=document.createElement("div");t.appendChild(e);const i=t.offsetWidth-t.clientWidth;return(n=t.parentNode)==null||n.removeChild(t),i}setup(t,e){this.updateCanvasSize(t,e)}updateCanvasSize(t,e){this.container.setAttribute("data-width",`${t}`),this.container.setAttribute("data-height",`${e}`),this.hScrollbar.innerHTML=`<div class="placeholder" style="width: ${t}px; height: 1px;"></div>`,this.vScrollbar.innerHTML=`<div class="placeholder" style="width: 1px; height: ${e}px;"></div>`;const i=this.container.clientWidth-this.systemScrollbarWidth,n=this.container.clientHeight-this.systemScrollbarWidth;this.canvas.width=i,this.canvas.height=n,this.canvas.style.width=`${i}px`,this.canvas.style.height=`${n}px`}getHScrollbar(){return this.hScrollbar}getVScrollbar(){return this.vScrollbar}getHScrollPosition(){return this.hScrollbar.scrollLeft}setHScrollPosition(t){return this.hScrollbar.scrollLeft=t,this.hScrollbar.scrollLeft}getVScrollPosition(){return this.vScrollbar.scrollTop}setVScrollPosition(t){return this.vScrollbar.scrollTop=t,this.vScrollbar.scrollTop}getCanvas(){return this.canvas}getContext(){return this.ctx}getEditorInput(){return this.editorInput}getDropdownElements(){return{dropdown:this.dropdown,searchInput:this.dropdownSearchInput,list:this.dropdownList}}focusContainer(){this.container.focus()}setCursor(t){this.canvas.style.cursor=t}getCanvasBoundingClientRect(){return this.canvas.getBoundingClientRect()}}function d(g,t,...e){!t&&g!=="error"||console[g](...e)}function wt(g,t,e){if(g==null)return"";switch(t){case"date":try{const i=String(g),n=g instanceof Date?g:new Date(i.includes("T")?i:i+"T00:00:00Z");if(!isNaN(n.getTime()))return n.toLocaleDateString(void 0,{timeZone:"UTC"})}catch(i){d("warn",!1,"Error formatting date value:",g,i)}return String(g);case"boolean":return g===!0?"True":g===!1?"False":"";case"select":if(e){const i=e.find(n=>n.id===g);return i?i.name:""}return"";case"number":return String(g);case"text":case"email":default:return String(g)}}function mt(g,t){if(g==null)return"";if(t==="date"){try{const e=String(g),i=g instanceof Date?g:new Date(e.includes("T")?e:e+"T00:00:00Z");if(!isNaN(i.getTime())){const n=i.getUTCFullYear(),s=(i.getUTCMonth()+1).toString().padStart(2,"0"),r=i.getUTCDate().toString().padStart(2,"0");return`${n}-${s}-${r}`}}catch(e){d("warn",!1,"Error formatting date for input:",g,e)}return""}return String(g)}function Ct(g,t){if(g==="")return null;switch(t){case"number":const e=parseFloat(g);return isNaN(e)?null:e;case"boolean":return g.toLowerCase()==="true";case"date":return g;case"text":case"email":default:return g}}function k(g,t,e,i){if(!t)return!0;if(t.required&&(g==null||g===""))return d("warn",i,`Validation failed: Column "${e}" is required.`),!1;if(g==null||g==="")return!0;switch(t.type){case"text":if(t.maxlength&&typeof g=="string"&&g.length>t.maxlength)return d("warn",i,`Validation failed: Column "${e}" exceeds max length of ${t.maxlength}.`),!1;break;case"email":if(typeof g!="string"||!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(g))return d("warn",i,`Validation failed: Invalid email format for column "${e}".`),!1;break;case"number":if(typeof g!="number")return d("warn",i,`Validation failed: Column "${e}" expects a number.`),!1;if(t.decimal===!1&&!Number.isInteger(g))return d("warn",i,`Validation failed: Column "${e}" expects an integer.`),!1;break;case"date":if(typeof g!="string"||!/^\d{4}-\d{2}-\d{2}$/.test(g)||isNaN(new Date(g+"T00:00:00Z").getTime()))return d("warn",i,`Validation failed: Invalid date format (YYYY-MM-DD) for column "${e}".`),!1;break;case"boolean":if(typeof g!="boolean")return d("warn",i,`Validation failed: Column "${e}" expects a boolean.`),!1;break;case"select":if(g!==null&&t.values&&!t.values.some(n=>n.id===g))return d("warn",i,`Validation failed: Invalid selection for column "${e}".`),!1;break}return!0}class Mt{constructor(t,e,i){this.options=t,this.stateManager=e,this.domManager=i}initializeSizes(t){const e=this.stateManager.getColumns().map(()=>this.options.defaultColumnWidth),i=Array(t).fill(this.options.defaultRowHeight);this.stateManager.setColumnWidths(e),this.stateManager.setRowHeights(i),d("log",this.options.verbose,"Initialized column widths:",e),d("log",this.options.verbose,"Initialized row heights:",i),this.calculateTotalSize()}calculateDimensions(t,e){const i=this.domManager.getSystemScrollbarWidth();this.stateManager.updateViewportSize(t-i,e-i),this.calculateTotalSize(),d("log",this.options.verbose,"Calculated Dimensions:",{totalContentWidth:this.stateManager.getTotalContentWidth(),totalContentHeight:this.stateManager.getTotalContentHeight(),viewportWidth:this.stateManager.getViewportWidth(),viewportHeight:this.stateManager.getViewportHeight()}),this.calculateVisibleRange()}calculateTotalSize(){let t=this.options.rowNumberWidth;this.stateManager.getColumnWidths().forEach(i=>t+=i);let e=this.options.headerHeight;this.stateManager.getRowHeights().forEach(i=>e+=i),this.stateManager.updateTotalContentSize(t,e)}calculateVisibleRange(){const{headerHeight:t,rowNumberWidth:e}=this.options,i=this.stateManager.getData(),n=this.stateManager.getColumns(),s=this.stateManager.getColumnWidths(),r=this.stateManager.getRowHeights(),a=this.stateManager.getScrollLeft(),o=this.stateManager.getScrollTop(),l=this.stateManager.getViewportWidth(),h=this.stateManager.getViewportHeight();let c=e,f=-1,m=n.length-1;for(let u=0;u<n.length;u++){const M=s[u],S=c+M;if(S>a&&c<a+l)f===-1&&(f=u),m=u;else if(f!==-1)break;c=S}f===-1&&(f=0,m=-1);let p=t,C=-1,w=i.length-1;for(let u=0;u<i.length;u++){const M=r[u],S=p+M;if(S>o&&p<o+h)C===-1&&(C=u),w=u;else if(C!==-1)break;p=S}C===-1&&(C=0,w=-1),this.stateManager.updateVisibleRange(C,w,f,m),d("log",this.options.verbose,"Calculated Visible Range:",{rows:`${C} - ${w}`,cols:`${f} - ${m}`})}getColumnLeft(t){let e=this.options.rowNumberWidth;const i=this.stateManager.getColumnWidths();for(let n=0;n<t;n++)e+=i[n];return e}getRowTop(t){let e=this.options.headerHeight;const i=this.stateManager.getRowHeights();for(let n=0;n<t;n++)e+=i[n];return e}}class St{constructor(t,e,i,n){this.ctx=t,this.options=e,this.stateManager=i,this.dimensionCalculator=n}draw(){this.ctx.save(),this.ctx.font=this.options.font,this._clearCanvas(),this.ctx.translate(-this.stateManager.getScrollLeft(),-this.stateManager.getScrollTop()),this._drawHeaders(),this._drawRowNumbers(),this._drawCells(),this._drawGridLines(),this._drawCopiedCellHighlight(),this._drawActiveCellHighlight(),this._drawSelectedColumnHighlight(),this._drawSelectedRowsHighlight(),this._drawDragRange(),this._drawCornerBox(),this.ctx.restore()}_clearCanvas(){this.ctx.fillStyle="#ffffff",this.ctx.fillRect(0,0,this.stateManager.getViewportWidth(),this.stateManager.getViewportHeight())}_drawCornerBox(){const{rowNumberWidth:t,headerHeight:e,gridLineColor:i,rowNumberBgColor:n}=this.options,s=0,r=0;this.ctx.save(),this.ctx.fillStyle=n,this.ctx.fillRect(s,r,t,e),this.ctx.strokeStyle=i,this.ctx.strokeRect(s+.5,r+.5,t,e),this.ctx.restore()}_drawHeaders(){const{headerHeight:t,rowNumberWidth:e,headerFont:i,headerBgColor:n,headerTextColor:s,gridLineColor:r,headerClipText:a,headerTextAlign:o,padding:l}=this.options,h=this.stateManager.getColumns(),c=this.stateManager.getSchema(),f=this.stateManager.getColumnWidths(),m=this.stateManager.getVisibleColStartIndex(),p=this.stateManager.getVisibleColEndIndex(),C=this.stateManager.getTotalContentWidth(),w=this.stateManager.getSelectedColumn();this.ctx.save();const u=e,M=0,S=C,b=t;this.ctx.beginPath(),this.ctx.rect(u,M,S-e,b),this.ctx.clip(),this.ctx.fillStyle=n,this.ctx.fillRect(e,0,C-e,t),this.ctx.font=i,this.ctx.textAlign=o,this.ctx.textBaseline="middle";let y=this.dimensionCalculator.getColumnLeft(m);for(let D=m;D<=p;D++){if(D<0||D>=h.length)continue;const W=h[D],_=c[W],L=(_==null?void 0:_.label)||W,H=f[D],N=w===D;let T=null;N?T=this.options.selectedHeaderBgColor:W.startsWith("custom:")&&(T=this.options.customHeaderBgColor),T&&(this.ctx.fillStyle=T,this.ctx.fillRect(y,0,H,t)),this.ctx.fillStyle=N?this.options.selectedHeaderTextColor:s;let E=y+l;o==="center"?E=y+H/2:o==="right"&&(E=y+H-l),a?(this.ctx.save(),this.ctx.beginPath(),this.ctx.rect(y,0,H,t),this.ctx.clip(),this.ctx.fillText(L,E,t/2),this.ctx.restore()):this.ctx.fillText(L,E,t/2,H-l*2),this.ctx.strokeStyle=r,this.ctx.beginPath();const $=Math.round(y+H)-.5;this.ctx.moveTo($,0),this.ctx.lineTo($,t),this.ctx.stroke(),y+=H}this.ctx.restore(),this.ctx.strokeStyle=r,this.ctx.beginPath();const v=t-.5;this.ctx.moveTo(e,v),this.ctx.lineTo(this.stateManager.getTotalContentWidth(),v),this.ctx.stroke()}_drawRowNumbers(){const{headerHeight:t,rowNumberWidth:e,font:i,rowNumberBgColor:n,selectedRowNumberBgColor:s,textColor:r,gridLineColor:a}=this.options,o=this.stateManager.getData(),l=this.stateManager.getRowHeights(),h=this.stateManager.getSelectedRows(),c=this.stateManager.getVisibleRowStartIndex(),f=this.stateManager.getVisibleRowEndIndex(),m=this.stateManager.getTotalContentHeight();this.ctx.save();const p=0,C=t,w=e,u=m;this.ctx.beginPath(),this.ctx.rect(p,C,w,u-t),this.ctx.clip(),this.ctx.fillStyle=n,this.ctx.fillRect(0,t,e,m-t),this.ctx.font=i,this.ctx.textAlign="center",this.ctx.textBaseline="middle";let M=this.dimensionCalculator.getRowTop(c);for(let b=c;b<=f;b++){if(b<0||b>=o.length)continue;const y=l[b];h.has(b)&&(this.ctx.fillStyle=s,this.ctx.fillRect(0,M,e,y)),this.ctx.fillStyle=r,this.ctx.fillText((b+1).toString(),e/2,M+y/2),this.ctx.strokeStyle=a,this.ctx.beginPath();const v=Math.round(M+y)-.5;this.ctx.moveTo(0,v),this.ctx.lineTo(e,v),this.ctx.stroke(),M+=y}this.ctx.restore(),this.ctx.strokeStyle=a,this.ctx.beginPath();const S=e-.5;this.ctx.moveTo(S,t),this.ctx.lineTo(S,this.stateManager.getViewportHeight()),this.ctx.stroke()}_drawCells(){var j,G,Z,Q,tt;const{headerHeight:t,rowNumberWidth:e,font:i,textColor:n,textAlign:s,textBaseline:r,padding:a,cellBgColor:o,activeCellBgColor:l,selectedRowBgColor:h,selectedRangeBgColor:c,disabledCellBgColor:f,disabledCellTextColor:m,errorCellBgColor:p,errorTextColor:C,loadingTextColor:w,placeholderTextColor:u}=this.options,M=this.stateManager.getData(),S=this.stateManager.getColumns(),b=this.stateManager.getSchema(),y=this.stateManager.getRowHeights(),v=this.stateManager.getColumnWidths(),D=this.stateManager.getVisibleRowStartIndex(),W=this.stateManager.getVisibleRowEndIndex(),_=this.stateManager.getVisibleColStartIndex(),L=this.stateManager.getVisibleColEndIndex(),H=this.stateManager.getSelectedRows(),N=this.stateManager.getSelectedColumn(),T=this.stateManager.getActiveCell(),E=this.stateManager.getNormalizedSelectionRange(),$=this.stateManager.getScrollLeft(),K=this.stateManager.getScrollTop();this.ctx.save();const J=Math.max(0,e-$),q=Math.max(0,t-K),lt=this.stateManager.getTotalContentWidth()-J,rt=this.stateManager.getTotalContentHeight()-q;this.ctx.beginPath(),this.ctx.rect(J+$,q+K,lt,rt),this.ctx.clip(),this.ctx.font=i,this.ctx.textAlign=s,this.ctx.textBaseline=r;let O=this.dimensionCalculator.getRowTop(D);for(let R=D;R<=W;R++){if(R<0||R>=M.length)continue;const U=y[R],ht=H.has(R);let z=this.dimensionCalculator.getColumnLeft(_);for(let x=_;x<=L;x++){if(x<0||x>=S.length)continue;const A=v[x],B=S[x],I=b[B],et=(j=M[R])==null?void 0:j[`error:${B}`],it=this.stateManager.isCellDisabled(R,x),st=(T==null?void 0:T.row)===R&&(T==null?void 0:T.col)===x,F=((G=this.stateManager.getActiveEditor())==null?void 0:G.row)===R&&((Z=this.stateManager.getActiveEditor())==null?void 0:Z.col)===x,ct=N===x,dt=(Q=M[R])==null?void 0:Q[`loading:${B}`],gt=E&&R>=E.start.row&&R<=E.end.row&&x>=E.start.col&&x<=E.end.col;let V=o;ht&&(V=h),ct&&(V=h),gt&&!st&&(V=c),it&&(V=f),st&&!F&&(V=l),et&&(V=p),!F&&V&&(this.ctx.fillStyle=V,this.ctx.fillRect(z,O,A,U));let nt=!0;if(F&&!["select","boolean"].includes(I==null?void 0:I.type)&&(nt=!1),nt){const at=O+U/2;let Y=z+a;if(dt)this.ctx.fillStyle=w,this.ctx.fillText("(Loading...)",Y,at,A-a*2);else{const ut=(tt=M[R])==null?void 0:tt[B],P=wt(ut,I==null?void 0:I.type,I==null?void 0:I.values);P!=null&&P!==""&&(this.ctx.fillStyle=it?m:F?u:et?C:n,s==="center"?Y=z+A/2:s==="right"&&(Y=z+A-a),this.ctx.fillText(P,Y,at))}}z+=A}O+=U}this.ctx.restore()}_drawGridLines(){const{headerHeight:t,rowNumberWidth:e,gridLineColor:i}=this.options,n=this.stateManager.getTotalContentWidth(),s=this.stateManager.getTotalContentHeight(),r=this.stateManager.getColumns(),a=this.stateManager.getData(),o=this.stateManager.getColumnWidths(),l=this.stateManager.getRowHeights(),h=this.stateManager.getViewportWidth(),c=this.stateManager.getViewportHeight(),f=this.stateManager.getScrollLeft(),m=this.stateManager.getScrollTop();this.ctx.save(),this.ctx.strokeStyle=i,this.ctx.lineWidth=1;let p=e;for(let w=0;w<=r.length;w++){const u=Math.round(p)-.5;if(u>=e&&u<=h+f&&(this.ctx.beginPath(),this.ctx.moveTo(u,t),this.ctx.lineTo(u,s),this.ctx.stroke()),w<r.length&&(p+=o[w]),p>h+f)break}let C=t;for(let w=0;w<=a.length;w++){const u=Math.round(C)-.5;if(u>=t&&u<=c+m&&(this.ctx.beginPath(),this.ctx.moveTo(e,u),this.ctx.lineTo(n,u),this.ctx.stroke()),w<a.length&&(C+=l[w]),C>c+m)break}this.ctx.restore()}_drawActiveCellHighlight(){const t=this.stateManager.getActiveCell(),e=this.stateManager.isDraggingFillHandle(),i=this.stateManager.isResizing(),n=this.stateManager.getActiveEditor(),s=this.stateManager.getNormalizedSelectionRange();if(i||e||!t&&!s)return;const{highlightBorderColor:r,fillHandleColor:a,fillHandleSize:o}=this.options;this.ctx.save(),this.ctx.strokeStyle=r,this.ctx.lineWidth=2;let l=null,h=null;if(s){const c=this.getCellBounds(s.start.row,s.start.col),f=this.getCellBounds(s.end.row,s.end.col);c&&f&&(l={x:c.x,y:c.y,width:f.x+f.width-c.x,height:f.y+f.height-c.y}),t&&t.row!==null&&t.col!==null&&(h=this.getCellBounds(t.row,t.col))}else t&&t.row!==null&&t.col!==null&&(h=this.getCellBounds(t.row,t.col),l=h);if(l&&this.ctx.strokeRect(l.x+1,l.y+1,l.width-2,l.height-2),!n&&h){const c=o/2,f=h.x+h.width-c-1,m=h.y+h.height-c-1;this.ctx.fillStyle=a,this.ctx.beginPath(),this.ctx.arc(f,m,c,0,Math.PI*2),this.ctx.fill(),this.ctx.strokeStyle="#ffffff",this.ctx.lineWidth=1,this.ctx.stroke()}this.ctx.restore()}_drawDragRange(){const t=this.stateManager.isDraggingFillHandle(),e=this.stateManager.getDragStartCell(),i=this.stateManager.getDragEndRow();if(!t||!e||i===null||i===e.row)return;const{row:n,col:s}=e;if(n===null||s===null)return;const{dragRangeBorderColor:r}=this.options,a=i,o=this.stateManager.getColumnWidths(),l=this.stateManager.getRowHeights();if(s<0||s>=o.length)return;const h=o[s],c=this.dimensionCalculator.getColumnLeft(s),f=a>=n;let m,p;if(f){m=this.dimensionCalculator.getRowTop(n)+l[n],p=0;for(let M=n+1;M<=a&&!(M>=l.length);M++)p+=l[M]||this.options.defaultRowHeight}else{m=this.dimensionCalculator.getRowTop(a),p=0;for(let u=a;u<n&&!(u>=l.length);u++)p+=l[u]||this.options.defaultRowHeight}if(p<=0)return;const C=c,w=m;this.ctx.save(),this.ctx.strokeStyle=r,this.ctx.lineWidth=2,this.ctx.setLineDash([4,2]),this.ctx.strokeRect(C+.5,w+.5,h-1,p-1),this.ctx.restore()}_drawCopiedCellHighlight(){const t=this.stateManager.getCopiedCell(),e=this.stateManager.getCopiedSourceRange();if(!t&&!e)return;const{copyHighlightBorderColor:i,copyHighlightBorderDash:n}=this.options;let s=null;if(e){const r=this.getCellBounds(e.start.row,e.start.col),a=this.getCellBounds(e.end.row,e.end.col);r&&a&&(s={x:r.x,y:r.y,width:a.x+a.width-r.x,height:a.y+a.height-r.y})}else t&&t.row!==null&&t.col!==null&&(s=this.getCellBounds(t.row,t.col));s&&(this.ctx.save(),this.ctx.strokeStyle=i,this.ctx.lineWidth=1,this.ctx.setLineDash(n),this.ctx.strokeRect(s.x+.5,s.y+.5,s.width-1,s.height-1),this.ctx.restore())}_drawSelectedColumnHighlight(){const t=this.stateManager.getSelectedColumn();if(t===null)return;const{highlightBorderColor:e}=this.options,i=this.stateManager.getTotalContentHeight(),n=this.stateManager.getColumnWidths(),s=this.dimensionCalculator.getColumnLeft(t),r=n[t];r&&(this.ctx.save(),this.ctx.strokeStyle=e,this.ctx.lineWidth=2,this.ctx.strokeRect(s+1,1,r-2,i-2),this.ctx.restore())}_drawSelectedRowsHighlight(){const t=this.stateManager.getSelectedRows();if(t.size===0)return;const{highlightBorderColor:e}=this.options,i=this.stateManager.getTotalContentWidth(),n=this.stateManager.getRowHeights();this.ctx.save(),this.ctx.strokeStyle=e,this.ctx.lineWidth=2;for(const s of t){const r=n[s],a=this.dimensionCalculator.getRowTop(s);this.ctx.strokeRect(0,a,i,r)}this.ctx.restore()}getCellBounds(t,e){const i=this.stateManager.getData(),n=this.stateManager.getColumns(),s=this.stateManager.getColumnWidths(),r=this.stateManager.getRowHeights(),a=this.stateManager.getTotalContentWidth(),o=this.stateManager.getTotalContentHeight();if(t<0||t>=i.length||e<0||e>=n.length)return null;const l=s[e],h=r[t],c=this.dimensionCalculator.getColumnLeft(e),f=this.dimensionCalculator.getRowTop(t),m=c,p=f;return m<a&&m+l>0&&p<o&&p+h>0?{x:m,y:p,width:l,height:h}:null}getFillHandleBounds(t,e){const i=this.getCellBounds(t,e);if(!i)return null;const{fillHandleSize:n}=this.options,s=n/2,r=i.x+i.width-s-1,a=i.y+i.height-s-1;return{x:r-s,y:a-s,width:n,height:n}}}class bt{constructor(t,e,i,n,s,r,a,o){this.resizeTimeout=null,this._ignoreNextClick=!1,this.isCtrl=!1,this._customEventHandler=null,this.touchStartX=null,this.touchStartY=null,this.lastTouchX=null,this.lastTouchY=null,this.isTouching=!1,this.touchVelocityX=0,this.touchVelocityY=0,this.lastTouchTime=0,this.kineticScrollInterval=null,this.container=t,this.editingManager=e,this.interactionManager=i,this.stateManager=n,this.dimensionCalculator=s,this.renderer=r,this.options=a,this.domManager=o,this.canvas=this.domManager.getCanvas(),this.hScrollbar=this.domManager.getHScrollbar(),this.vScrollbar=this.domManager.getVScrollbar(),this.interactionManager.setEditingManager(this.editingManager)}bindEvents(t=null){this._customEventHandler=t,this.container.addEventListener("wheel",this._handleWheel.bind(this)),this.hScrollbar.addEventListener("scroll",this._handleHScroll.bind(this)),this.vScrollbar.addEventListener("scroll",this._handleVScroll.bind(this)),this.canvas.addEventListener("dblclick",this._handleDoubleClick.bind(this)),this.canvas.addEventListener("click",this._handleClick.bind(this)),this.canvas.addEventListener("mousedown",this._handleCanvasMouseDown.bind(this)),document.addEventListener("mousemove",this._handleDocumentMouseMove.bind(this)),document.addEventListener("mouseup",this._handleDocumentMouseUp.bind(this)),window.addEventListener("resize",this._handleResize.bind(this)),document.addEventListener("mousedown",this._handleGlobalMouseDown.bind(this),!0),document.addEventListener("keydown",this._handleDocumentKeyDown.bind(this)),document.addEventListener("keyup",this._handleDocumentKeyUp.bind(this)),this.container.addEventListener("paste",this._handlePaste.bind(this)),this.canvas.addEventListener("touchstart",this._handleTouchStart.bind(this)),this.canvas.addEventListener("touchmove",this._handleTouchMove.bind(this)),this.canvas.addEventListener("touchend",this._handleTouchEnd.bind(this)),this.canvas.addEventListener("touchcancel",this._handleTouchEnd.bind(this)),this.editingManager.bindInternalEvents()}_handleScroll(){this.editingManager.deactivateEditor(!1),this.editingManager.hideDropdown(),this.dimensionCalculator.calculateVisibleRange(),this.renderer.draw()}_handleWheel(t){const e=t.deltaY;t.preventDefault();const{scrollTop:i,scrollLeft:n}=this.interactionManager.moveScroll(t.shiftKey?e:0,t.shiftKey?0:e);this.stateManager.updateScroll(i,n),this._handleScroll()}_handleHScroll(t){const i=t.target.scrollLeft;this.stateManager.updateScroll(this.stateManager.getScrollTop(),i),this._handleScroll()}_handleVScroll(t){const i=t.target.scrollTop;this.stateManager.updateScroll(i,this.stateManager.getScrollLeft()),this._handleScroll()}_handleResize(){this.resizeTimeout&&clearTimeout(this.resizeTimeout),this.resizeTimeout=window.setTimeout(()=>{this.editingManager.deactivateEditor(!1),this.editingManager.hideDropdown(),this.dimensionCalculator.calculateDimensions(this.container.clientWidth,this.container.clientHeight),this.domManager.updateCanvasSize(this.stateManager.getTotalContentWidth(),this.stateManager.getTotalContentHeight()),this.renderer.draw(),this.resizeTimeout=null},100)}_handleDoubleClick(t){if(this.stateManager.isResizing()){d("log",this.options.verbose,"Double click ignored due to active resize.");return}const e=this._getCoordsFromEvent(t);if(!e||e.row===null||e.col===null)return;let i=!1;if(i=i||this.interactionManager.clearSelections(),i=i||this.interactionManager.clearCopiedCell(),i=i||this.stateManager.setActiveCell(e),this.stateManager.isCellDisabled(e.row,e.col)){d("log",this.options.verbose,`Edit prevented: Cell ${e.row},${e.col} is disabled.`),i&&this.renderer.draw();return}this.editingManager.activateEditor(e.row,e.col)}_handleClick(t){if(this._ignoreNextClick){this._ignoreNextClick=!1;return}if(this.stateManager.isDraggingFillHandle()||this.stateManager.isResizing()){d("log",this.options.verbose,"Click ignored due to active fill handle drag or resize.");return}const e=this._getCoordsFromEvent(t),i=e&&e.row!==null&&e.col!==null,n=e&&e.row!==null&&e.col===null&&this._isRowNumberAreaClick(t),s=this._isHeaderAreaClick(t);let r=!1;if(this.editingManager.isEditorActive()){const o=this.stateManager.getActiveEditor();i&&(e==null?void 0:e.row)===(o==null?void 0:o.row)&&(e==null?void 0:e.col)===(o==null?void 0:o.col)||this.editingManager.deactivateEditor(!0)}else this.editingManager.isDropdownVisible()&&this.editingManager.hideDropdown();const a=this.stateManager.isCopyActive();if(n&&e&&e.row!==null){const o=this.interactionManager.handleRowNumberClick(e.row,t.shiftKey,t.ctrlKey||t.metaKey),l=a?this.interactionManager.clearCopiedCell():!1;r=o||l}else if(s){const o=this._getColumnFromEvent(t);if(o!==null){const l=this.interactionManager.handleHeaderClick(o),h=a?this.interactionManager.clearCopiedCell():!1;r=l||h}}else if(i&&e&&e.row!==null){const o=this.stateManager.setActiveCell(e);let l=!1,h=!1;o&&(l=this.interactionManager.clearSelections(),h=this.stateManager.clearSelectionRange()),r=o||l||h}else{const o=this.stateManager.setActiveCell(null);let l=!1,h=!1;o&&(l=this.interactionManager.clearSelections(),h=this.stateManager.clearSelectionRange());const c=a?this.interactionManager.clearCopiedCell():!1;r=o||l||h||c}r&&this.renderer.draw()}_handleCanvasMouseDown(t){if(this._ignoreNextClick=!1,this.interactionManager.checkResizeHandles(t)){t.preventDefault(),t.stopPropagation();return}const i=this.stateManager.getActiveCell();let n=!1;if(i&&i.row!==null&&i.col!==null&&(n=!0,this.interactionManager.checkFillHandle(t))){t.preventDefault(),t.stopPropagation();return}const s=this._getCoordsFromEvent(t);if(s&&s.row!==null&&s.col!==null){if(this.editingManager.isEditorActive()){const a=this.stateManager.getActiveEditor();(s.row!==(a==null?void 0:a.row)||s.col!==(a==null?void 0:a.col))&&this.editingManager.deactivateEditor(!0)}if(t.shiftKey&&n&&s.row!==(i==null?void 0:i.row)&&s.col!==(i==null?void 0:i.col)){d("log",this.options.verbose,`shift click detected at ${i==null?void 0:i.row},${i==null?void 0:i.col} -> ${s.row},${s.col}`),t.preventDefault(),this.domManager.focusContainer();return}this.interactionManager.startSelectionDrag(s)&&this.renderer.draw(),t.preventDefault(),this.domManager.focusContainer()}}_handleDocumentMouseMove(t){if(this.stateManager.isResizing())this.interactionManager.handleResizeMouseMove(t);else if(this.stateManager.isDraggingFillHandle())this.interactionManager.handleFillHandleMouseMove(t),this._ignoreNextClick=!0;else if(this.stateManager.getIsDraggingSelection()){const e=this._getCoordsFromEvent(t);e&&this.interactionManager.updateSelectionDrag(e)&&this.renderer.draw()}else this.interactionManager.updateCursorStyle(t)}_handleDocumentMouseUp(t){let e=!1;const i=this.stateManager.getActiveCell();if(this.stateManager.getIsDraggingSelection())e=!0,this.interactionManager.endSelectionDrag();else if(t.shiftKey&&i&&i.row!==null&&i.col!==null){const n=this._getCoordsFromEvent(t);n&&n.row!==null&&n.col!==null&&(this.interactionManager.startSelectionDrag(i),this.interactionManager.updateSelectionDrag(n),this.interactionManager.endSelectionDrag(),this.renderer.draw(),e=!0,d("log",this.options.verbose,`shift click received: ${i.row},${i.col} -> ${n.row},${n.col}`))}this.stateManager.isResizing()&&this.interactionManager.endResize(),this.stateManager.isDraggingFillHandle()&&this.interactionManager.endFillHandleDrag(),this.interactionManager.updateCursorStyle(t),e&&(this._ignoreNextClick=!0)}_handleGlobalMouseDown(t){if(!(this.stateManager.isDraggingFillHandle()||this.stateManager.isResizing()||this.stateManager.getIsDraggingSelection())&&!this.container.contains(t.target)){let e=!1;if(this.editingManager.isEditorActive()||this.editingManager.isDropdownVisible())this.editingManager.deactivateEditor(!0);else{const i=this.stateManager.setActiveCell(null);let n=!1,s=!1;i&&(n=this.interactionManager.clearSelections(),s=this.stateManager.clearSelectionRange());const r=this.interactionManager.clearCopiedCell();e=i||n||s||r}e&&this.renderer.draw()}}_handleDocumentKeyDown(t){(t.ctrlKey||t.metaKey)&&(this.isCtrl=!0)}_handleDocumentKeyUp(t){var a,o;const e=this.isCtrl;(t.ctrlKey||t.metaKey)&&(this.isCtrl=!1);let i=!1,n=!1;if(this.editingManager.isEditorActive()||this.editingManager.isDropdownVisible())return;if(e&&t.key==="c"){i=this.interactionManager.copy(),t.preventDefault(),i&&this.renderer.draw();return}if(e&&t.key==="v"){i=this.interactionManager.paste(),t.preventDefault(),i&&this.renderer.draw();return}const s=this.stateManager.getActiveCell(),r=s&&s.row!==null&&s.col!==null&&this.stateManager.isCellDisabled(s.row,s.col);if(t.key==="Delete"||t.key==="Backspace"){const l=this.stateManager.getSelectedColumn();this.stateManager.getSelectedRows().size>0?(i=this.interactionManager.deleteSelectedRows(),t.preventDefault()):s&&s.row!==null&&s.col!==null?(r||(i=this.stateManager.updateCell(s.row,this.stateManager.getColumnKey(s.col),null)),t.preventDefault()):t.key==="Delete"&&l!==null&&((a=this.stateManager.getColumnKey(l))!=null&&a.startsWith("custom:"))&&(this.stateManager.removeColumn(l),i=!0,n=!0,t.preventDefault())}else if(t.key.startsWith("Arrow")){if(s){let l=0,h=0;t.key==="ArrowUp"?l=-1:t.key==="ArrowDown"?l=1:t.key==="ArrowLeft"?h=-1:t.key==="ArrowRight"&&(h=1),(l!==0||h!==0)&&(i=this.interactionManager.moveActiveCell(l,h,!1),i&&(this.interactionManager.clearSelections(),this.stateManager.clearSelectionRange()),t.preventDefault())}}else t.key==="Enter"&&s?!r&&s.row!==null&&s.col!==null&&(this.editingManager.activateEditor(s.row,s.col),t.preventDefault()):t.key==="Tab"&&s?(i=this.interactionManager.moveActiveCell(0,t.shiftKey?-1:1),i&&(this.interactionManager.clearSelections(),this.stateManager.clearSelectionRange()),t.preventDefault()):!e&&!t.ctrlKey&&t.key.length===1&&s&&s.row!==null&&s.col!==null&&!r&&this.editingManager.activateEditor(s.row,s.col,t.key);n?(o=this._customEventHandler)==null||o.call(this,new CustomEvent("resize")):i&&this.renderer.draw()}_handlePaste(t){if(this.editingManager.isEditorActive()||!t.clipboardData)return;const e=t.clipboardData.getData("text/plain");if(!e)return;if(this.interactionManager.paste()){t.preventDefault(),this.renderer.draw();return}const i=this.stateManager.getActiveCell(),n=this.stateManager.getNormalizedSelectionRange(),s=this.stateManager.getSelectedColumn();if(s!==null){const c=e.split(/\r\n|\n|\r/)[0].split("	")[0];c&&(d("log",this.options.verbose,"Handling column paste from clipboard"),t.preventDefault(),this.interactionManager.pasteToColumnExternal(s,c)&&this.renderer.draw());return}const r=n,a=!r&&i?i:null;if(!r&&!a){d("log",this.options.verbose,"Clipboard paste ignored: No target cell or range selected.");return}d("log",this.options.verbose,"Handling native paste event."),t.preventDefault();let o=!1;const l=e.split(/\r\n|\n|\r/).map(c=>c.split("	")),h=l.length===1&&l[0].length===1;r?o=this.interactionManager.pasteRangeToRangeExternal(r,l):a&&a.row!==null&&a.col!==null&&(h?o=this.interactionManager.pasteSingleValueExternal(a,l[0][0]):o=this.interactionManager.pasteRangeFromTopLeftExternal(a,l)),o&&this.renderer.draw()}_getCoordsFromEvent(t){const e=this.domManager.getCanvasBoundingClientRect(),i=t.clientX-e.left,n=t.clientY-e.top,s=i+this.stateManager.getScrollLeft(),r=n+this.stateManager.getScrollTop(),{headerHeight:a,rowNumberWidth:o}=this.options,l=this.stateManager.getData().length,h=this.stateManager.getColumns(),c=this.stateManager.getRowHeights(),f=this.stateManager.getColumnWidths();let m=null,p=null;if(r>=a){let C=a;for(let w=0;w<l;w++){const u=c[w]||this.options.defaultRowHeight;if(r>=C&&r<C+u){m=w;break}if(C+=u,C>r)break}}if(m!==null)if(s>=o){let C=o;for(let w=0;w<h.length;w++){const u=f[w]||this.options.defaultColumnWidth;if(s>=C&&s<C+u){p=w;break}if(C+=u,C>s)break}}else p=null;else m=null,p=null;return m===null&&p===null&&s>o&&r<a||m===null&&p===null&&s<o&&r<a?null:m!==null?{row:m,col:p}:null}_getColumnFromEvent(t){const e=this.domManager.getCanvasBoundingClientRect(),i=t.clientX-e.left+this.stateManager.getScrollLeft(),{rowNumberWidth:n}=this.options,s=this.stateManager.getColumns(),r=this.stateManager.getColumnWidths();if(i<n)return null;let a=n;for(let o=0;o<s.length;o++){const l=r[o]||this.options.defaultColumnWidth;if(i>=a&&i<a+l)return o;a+=l}return null}_isRowNumberAreaClick(t){const e=this.domManager.getCanvasBoundingClientRect();return t.clientX-e.left<this.options.rowNumberWidth}_isHeaderAreaClick(t){const e=this.domManager.getCanvasBoundingClientRect();return t.clientY-e.top<this.options.headerHeight}_handleTouchStart(t){if(t.preventDefault(),t.touches.length===1){const e=t.touches[0];this.touchStartX=e.clientX,this.touchStartY=e.clientY,this.lastTouchX=e.clientX,this.lastTouchY=e.clientY,this.isTouching=!0,this.lastTouchTime=Date.now(),this.kineticScrollInterval!==null&&(window.clearInterval(this.kineticScrollInterval),this.kineticScrollInterval=null),this.editingManager.deactivateEditor(!1),this.editingManager.hideDropdown()}}_handleTouchMove(t){if(!(!this.isTouching||!this.lastTouchX||!this.lastTouchY)&&(t.preventDefault(),t.touches.length===1)){const e=t.touches[0],i=e.clientX,n=e.clientY,s=this.lastTouchX-i,r=this.lastTouchY-n,a=Date.now(),o=a-this.lastTouchTime;o>0&&(this.touchVelocityX=s/o*15,this.touchVelocityY=r/o*15);const{scrollTop:l,scrollLeft:h}=this.interactionManager.moveScroll(s,r);this.stateManager.updateScroll(l,h),this._handleScroll(),this.lastTouchX=i,this.lastTouchY=n,this.lastTouchTime=a}}_handleTouchEnd(t){t.preventDefault(),this.isTouching=!1,(Math.abs(this.touchVelocityX)>.5||Math.abs(this.touchVelocityY)>.5)&&this._startKineticScroll()}_startKineticScroll(){this.kineticScrollInterval!==null&&window.clearInterval(this.kineticScrollInterval),this.kineticScrollInterval=window.setInterval(()=>{if(this.touchVelocityX*=.95,this.touchVelocityY*=.95,Math.abs(this.touchVelocityX)<.5&&Math.abs(this.touchVelocityY)<.5){window.clearInterval(this.kineticScrollInterval),this.kineticScrollInterval=null;return}const{scrollTop:t,scrollLeft:e}=this.interactionManager.moveScroll(this.touchVelocityX,this.touchVelocityY);this.stateManager.updateScroll(t,e),this._handleScroll()},16)}}class yt{constructor(t,e,i,n,s,r){this.dropdownItems=[],this.highlightedDropdownIndex=-1,this.container=t,this.options=e,this.stateManager=i,this.domManager=n,this.renderer=s,this.interactionManager=r,this.editorInput=this.domManager.getEditorInput();const a=this.domManager.getDropdownElements();this.dropdown=a.dropdown,this.dropdownSearchInput=a.searchInput,this.dropdownList=a.list}bindInternalEvents(){this.editorInput.addEventListener("blur",this._handleEditorBlur.bind(this)),this.editorInput.addEventListener("keydown",this._handleEditorKeyDown.bind(this)),this.dropdown.addEventListener("mousedown",t=>t.stopPropagation()),this.dropdownSearchInput.addEventListener("input",this._handleDropdownSearch.bind(this)),this.dropdownSearchInput.addEventListener("keydown",this._handleDropdownKeyDown.bind(this)),this.dropdownList.addEventListener("click",this._handleDropdownItemClick.bind(this))}isEditorActive(){return!!this.stateManager.getActiveEditor()}isDropdownVisible(){return this.dropdown.style.display!=="none"}activateEditor(t,e,i){const n=this.stateManager.getCellData(t,e),s=this.stateManager.getSchemaForColumn(e);if(this.stateManager.isCellDisabled(t,e)){d("log",this.options.verbose,`Edit prevented: Cell ${t},${e} is disabled.`);return}this.isEditorActive()&&this.deactivateEditor(!0),this.hideDropdown();const r=this.renderer.getCellBounds(t,e);if(!r){d("warn",this.options.verbose,`Cannot activate editor: Cell ${t},${e} bounds not found (likely not visible).`);return}this.stateManager.setActiveEditor({row:t,col:e,type:s==null?void 0:s.type,originalValue:n});const{x:a,y:o,width:l,height:h}=r,c=a-this.stateManager.getScrollLeft(),f=o-this.stateManager.getScrollTop();(s==null?void 0:s.type)==="select"||(s==null?void 0:s.type)==="boolean"?this._showDropdown(t,e,s,c,f,l,h):(this.editorInput.style.display="block",this.editorInput.style.left=`${c}px`,this.editorInput.style.top=`${f}px`,this.editorInput.style.width=`${l}px`,this.editorInput.style.height=`${h}px`,this.editorInput.style.font=this.options.font,(s==null?void 0:s.type)==="number"?(this.editorInput.type="number",this.editorInput.step=s.decimal===!1?"1":"any"):(s==null?void 0:s.type)==="email"?this.editorInput.type="email":(s==null?void 0:s.type)==="date"?this.editorInput.type="date":this.editorInput.type="text",this.editorInput.value=mt(n,s==null?void 0:s.type),this.editorInput.focus(),i&&(["text","email"].includes(s==null?void 0:s.type)||(s==null?void 0:s.type)==="number"&&i.match(/^\d*\.?\d*$/))?this.editorInput.value=i:this.editorInput.select()),this.renderer.draw()}deactivateEditor(t=!0,e=!1){const i=this.stateManager.getActiveEditor();if(!i)return;const{row:n,col:s,type:r,originalValue:a}=i;let o=!1,l=!1;if(r==="select"||r==="boolean")this.isDropdownVisible()&&(this.hideDropdown(),l=!0),o=this.stateManager.getCellData(n,s)!==a;else if(this.editorInput.style.display!=="none"){if(t){const h=this.editorInput.value,c=this.stateManager.getSchemaForColumn(s),f=this.stateManager.getColumnKey(s),m=Ct(h,c==null?void 0:c.type);k(m,c,f,this.options.verbose)?m!==a&&(this.stateManager.updateCellInternal(n,s,m),o=!0,this.interactionManager._batchUpdateCellsAndNotify([n],[f])):d("log",this.options.verbose,"Change not saved due to validation error.")}this.editorInput.style.display="none",this.editorInput.value="",l=!0}this.stateManager.setActiveEditor(null),e&&(this.stateManager.setActiveCell({row:n,col:s}),l=!0),(o||l)&&this.renderer.draw()}hasEditorSelection(){return this.highlightedDropdownIndex>=0}_handleEditorBlur(t){setTimeout(()=>{const e=t.relatedTarget;document.activeElement!==this.editorInput&&!this.dropdown.contains(e)&&this.deactivateEditor(!0)},0)}_handleEditorKeyDown(t){let e=!1;switch(t.key){case"Enter":this.deactivateEditor(!0),e=this.interactionManager.moveActiveCell(1,0),e&&(this.interactionManager.clearSelections(),this.stateManager.clearSelectionRange()),t.preventDefault();break;case"Escape":this.deactivateEditor(!1,!0),this.domManager.focusContainer(),t.preventDefault();return;case"Tab":this.deactivateEditor(!0),e=this.interactionManager.moveActiveCell(0,t.shiftKey?-1:1),e&&(this.interactionManager.clearSelections(),this.stateManager.clearSelectionRange()),t.preventDefault();break}e&&this.renderer.draw()}_showDropdown(t,e,i,n,s,r,a){if(this.dropdownItems=[],this.dropdownList.innerHTML="",(i==null?void 0:i.type)==="boolean")this.dropdownItems=[{id:!0,name:"True"},{id:!1,name:"False"},{id:null,name:"(Blank)"}];else if((i==null?void 0:i.type)==="select"&&i.values)this.dropdownItems=[{id:null,name:"(Blank)"},...i.values];else{d("warn",this.options.verbose,`Dropdown requested for non-dropdown type: ${i==null?void 0:i.type}`);return}this.dropdownItems.forEach((o,l)=>{const h=document.createElement("li");h.className="spreadsheet-dropdown-item",h.textContent=o.name,h.dataset.index=String(l),h.dataset.value=String(o.id===null||o.id===void 0?"":o.id),h.style.padding="5px 10px",h.style.cursor="pointer",h.addEventListener("mouseenter",()=>h.style.backgroundColor="#f0f0f0"),h.addEventListener("mouseleave",()=>h.style.backgroundColor="white"),this.dropdownList.appendChild(h)}),this.dropdown.style.display="block",this.dropdown.style.left=`${n}px`,this.dropdown.style.top=`${s+a}px`,this.dropdown.style.minWidth=`${r}px`,this.dropdown.style.maxHeight="200px",requestAnimationFrame(()=>{var c;const o=this.dropdown.getBoundingClientRect(),l=this.container.getBoundingClientRect();if(o.bottom>l.bottom&&s>=o.height&&(this.dropdown.style.top=`${s-o.height}px`),o.right>l.right){const f=l.right-o.width-5;this.dropdown.style.left=`${Math.max(0,f)}px`}o.left<l.left&&(this.dropdown.style.left=`${l.left}px`),parseFloat(this.dropdown.style.top)<l.top&&(this.dropdown.style.top=`${l.top}px`);const h=(((c=this.dropdown.firstChild)==null?void 0:c.clientHeight)||0)+15;this.dropdown.style.maxHeight=`${200+h}px`}),this.dropdownSearchInput.value="",this._filterDropdown(""),this.dropdownSearchInput.focus(),this.highlightedDropdownIndex=-1,this._updateDropdownHighlight(Array.from(this.dropdownList.querySelectorAll("li:not(.hidden)")))}hideDropdown(){this.dropdown.style.display!=="none"&&(this.dropdown.style.display="none",this.highlightedDropdownIndex=-1)}_handleDropdownSearch(){const t=this.dropdownSearchInput.value.toLowerCase();this._filterDropdown(t);const e=Array.from(this.dropdownList.querySelectorAll("li:not(.hidden)"));this.highlightedDropdownIndex=e.length>0?0:-1,this._updateDropdownHighlight(e)}_filterDropdown(t){this.dropdownList.querySelectorAll("li").forEach(i=>{var r;const s=(((r=i.textContent)==null?void 0:r.toLowerCase())||"").includes(t);i.classList.toggle("hidden",!s),i.style.display=s?"block":"none"})}_handleDropdownKeyDown(t){const e=Array.from(this.dropdownList.querySelectorAll("li:not(.hidden)"));if(!e.length&&t.key!=="Escape")return;let i=this.highlightedDropdownIndex;switch(t.key){case"ArrowDown":t.preventDefault(),i=(i+1)%e.length;break;case"ArrowUp":t.preventDefault(),i=(i-1+e.length)%e.length;break;case"Enter":t.preventDefault();let n=-1;i>=0&&i<e.length?n=i:e.length===1&&(n=0),n>=0&&e[n].click();return;case"Escape":t.preventDefault(),this.deactivateEditor(!1,!0),this.domManager.focusContainer();return;case"Tab":if(t.preventDefault(),!`${this.dropdownSearchInput.value}`.trim()&&i<0){this.deactivateEditor(!1);return}break;default:return}this.highlightedDropdownIndex=i,this._updateDropdownHighlight(e)}_updateDropdownHighlight(t){t.forEach((e,i)=>{const n=i===this.highlightedDropdownIndex;e.classList.toggle("highlighted",n),e.style.backgroundColor=n?"#dbeafe":"white",n&&e.scrollIntoView({block:"nearest"})})}_handleDropdownItemClick(t){const e=t.target;if(e.tagName==="LI"&&e.classList.contains("spreadsheet-dropdown-item")){const i=this.stateManager.getActiveEditor();if(!i)return;const n=parseInt(e.dataset.index||"-1",10);if(n<0||n>=this.dropdownItems.length)return;const s=this.dropdownItems[n],{row:r,col:a}=i;let o=s.id;typeof o=="string"&&i.type==="boolean"&&(o.toLowerCase()==="true"?o=!0:o.toLowerCase()==="false"&&(o=!1)),this.stateManager.updateCellInternal(r,a,o),this.interactionManager._batchUpdateCellsAndNotify([r],[this.stateManager.getColumnKey(a)]),setTimeout(()=>{this.deactivateEditor(!1),this.domManager.focusContainer()},200)}}}class vt{constructor(t,e,i,n,s){this.lastPasteHandledAt=null,this.options=t,this.stateManager=e,this.renderer=i,this.dimensionCalculator=n,this.domManager=s}setEditingManager(t){this.editingManager=t}moveScroll(t,e,i=!1){return{scrollTop:this.domManager.setVScrollPosition(i?e:this.domManager.getVScrollPosition()+e),scrollLeft:this.domManager.setHScrollPosition(i?t:this.domManager.getHScrollPosition()+t)}}handleRowNumberClick(t,e,i){d("log",this.options.verbose,`Row ${t} clicked. Shift: ${e}, Ctrl: ${i}`);const n=new Set(this.stateManager.getSelectedRows());let s=this.stateManager.getLastClickedRow();const r=JSON.stringify(Array.from(n).sort()),a=s;if(e&&s!==null){const c=Math.min(s,t),f=Math.max(s,t),m=new Set;for(let p=c;p<=f;p++)m.add(p);JSON.stringify(Array.from(m).sort())!==r&&this.stateManager.setSelectedRows(m,s),d("log",this.options.verbose,"Selected rows (Shift):",Array.from(m).sort((p,C)=>p-C))}else i?(n.has(t)?n.delete(t):n.add(t),s=t,this.stateManager.setSelectedRows(n,s),d("log",this.options.verbose,"Selected rows (Ctrl):",Array.from(n).sort((c,f)=>c-f))):(n.clear(),n.add(t),s=t,this.stateManager.setSelectedRows(n,s),d("log",this.options.verbose,"Selected rows (Single):",Array.from(n).sort((c,f)=>c-f)));const o=JSON.stringify(Array.from(this.stateManager.getSelectedRows()).sort())!==r,l=this.stateManager.getLastClickedRow()!==a,h=o||l;return h&&(this.stateManager.setActiveCell(null),this.stateManager.clearSelectionRange(),this.stateManager.setSelectedColumn(null)),h}handleHeaderClick(t){d("log",this.options.verbose,`Column ${t} clicked.`);const e=this.stateManager.getSelectedColumn();this.stateManager.setSelectedColumn(t);const i=e!==t;return i&&(this.stateManager.setActiveCell(null),this.stateManager.clearSelectionRange(),this.stateManager.setSelectedRows(new Set,null)),i}clearSelections(){let t=!1;return this.stateManager.getSelectedRows().size>0&&(t=this.stateManager.setSelectedRows(new Set,null)||t),this.stateManager.getSelectedColumn()!==null&&(t=this.stateManager.setSelectedColumn(null)||t),t}checkResizeHandles(t){const e=this.domManager.getCanvasBoundingClientRect(),i=t.clientX-e.left,n=t.clientY-e.top,s=i+this.stateManager.getScrollLeft(),r=n+this.stateManager.getScrollTop(),{headerHeight:a,rowNumberWidth:o,resizeHandleSize:l}=this.options,h=this.stateManager.getColumns(),c=this.stateManager.getData(),f=this.stateManager.getColumnWidths(),m=this.stateManager.getRowHeights();if(r<a&&s>o){let p=o;for(let C=0;C<h.length;C++){const w=f[C],u=p+w;if(Math.abs(s-u)<=l)return this._startColumnResize(C,t.clientX),"column";p=u}}if(s<o&&r>a){let p=a;for(let C=0;C<c.length;C++){const w=m[C],u=p+w;if(Math.abs(r-u)<=l)return this._startRowResize(C,t.clientY),"row";p=u}}return null}_startColumnResize(t,e){d("log",this.options.verbose,`Starting column resize for index ${t}`),this.stateManager.setResizeColumnState({isResizing:!0,columnIndex:t,startX:e}),this.domManager.setCursor("col-resize")}_startRowResize(t,e){d("log",this.options.verbose,`Starting row resize for index ${t}`),this.stateManager.setResizeRowState({isResizing:!0,rowIndex:t,startY:e}),this.domManager.setCursor("row-resize")}handleResizeMouseMove(t){const e=this.stateManager.getResizeColumnState(),i=this.stateManager.getResizeRowState();if(e.isResizing&&e.columnIndex!==null&&e.startX!==null){const{minColumnWidth:n,maxColumnWidth:s}=this.options,r=t.clientX-e.startX,a=this.stateManager.getColumnWidths(),o=e.columnIndex,l=a[o];let h=l+r;if(h=Math.max(n,Math.min(h,s)),h!==l){const c=[...a];c[o]=h,this.stateManager.setColumnWidths(c),this.stateManager.setResizeColumnState({...e,startX:t.clientX}),this.dimensionCalculator.calculateTotalSize(),this.dimensionCalculator.calculateVisibleRange(),this.domManager.updateCanvasSize(this.stateManager.getTotalContentWidth(),this.stateManager.getTotalContentHeight()),this.renderer.draw()}}else if(i.isResizing&&i.rowIndex!==null&&i.startY!==null){const{minRowHeight:n,maxRowHeight:s}=this.options,r=t.clientY-i.startY,a=this.stateManager.getRowHeights(),o=i.rowIndex,l=a[o];let h=l+r;if(h=Math.max(n,Math.min(h,s)),h!==l){const c=[...a];c[o]=h,this.stateManager.setRowHeights(c),this.stateManager.setResizeRowState({...i,startY:t.clientY}),this.dimensionCalculator.calculateTotalSize(),this.dimensionCalculator.calculateVisibleRange(),this.domManager.updateCanvasSize(this.stateManager.getTotalContentWidth(),this.stateManager.getTotalContentHeight()),this.renderer.draw()}}}endResize(){const t=this.stateManager.getResizeColumnState(),e=this.stateManager.getResizeRowState();t.isResizing&&(d("log",this.options.verbose,`Finished column resize for index ${t.columnIndex}. New width: ${this.stateManager.getColumnWidths()[t.columnIndex]}`),this.stateManager.setResizeColumnState({isResizing:!1,columnIndex:null,startX:null})),e.isResizing&&(d("log",this.options.verbose,`Finished row resize for index ${e.rowIndex}. New height: ${this.stateManager.getRowHeights()[e.rowIndex]}`),this.stateManager.setResizeRowState({isResizing:!1,rowIndex:null,startY:null}))}updateCursorStyle(t){if(this.stateManager.isResizing()||this.stateManager.isDraggingFillHandle())return;const e=this.stateManager.getScrollTop(),i=this.stateManager.getScrollLeft(),n=this.domManager.getCanvasBoundingClientRect(),s=t.clientX-n.left,r=t.clientY-n.top,a=s+i,o=r+e,{headerHeight:l,rowNumberWidth:h,resizeHandleSize:c}=this.options,f=this.stateManager.getColumns(),m=this.stateManager.getData(),p=this.stateManager.getColumnWidths(),C=this.stateManager.getRowHeights();let w="default";if(o<l&&a>h&&e<l){let M=h;for(let S=0;S<f.length;S++){const b=M+p[S];if(Math.abs(a-b)<=c){w="col-resize";break}if(M=b,M>a+c)break}}if(w==="default"&&a<h&&o>l&&i<h){let M=l;for(let S=0;S<m.length;S++){const b=M+C[S];if(Math.abs(o-b)<=c){w="row-resize";break}if(M=b,M>o+c)break}}const u=this.stateManager.getActiveCell();if(w==="default"&&u&&u.row!==null&&u.col!==null&&!this.stateManager.getActiveEditor()){const M=this.renderer.getFillHandleBounds(u.row,u.col);M&&a>=M.x&&a<=M.x+M.width&&o>=M.y&&o<=M.y+M.height&&(w="crosshair")}this.domManager.setCursor(w)}checkFillHandle(t){const e=this.stateManager.getActiveCell();if(!e||this.stateManager.getActiveEditor()||this.stateManager.isResizing()||e.row===null||e.col===null)return!1;const i=this.renderer.getFillHandleBounds(e.row,e.col);if(!i)return!1;const n=this.domManager.getCanvasBoundingClientRect(),s=t.clientX-n.left+this.stateManager.getScrollLeft(),r=t.clientY-n.top+this.stateManager.getScrollTop();return s>=i.x&&s<=i.x+i.width&&r>=i.y&&r<=i.y+i.height?(this._startFillHandleDrag(e),!0):!1}_startFillHandleDrag(t){t.row===null||t.col===null||(this.stateManager.setDragState({isDragging:!0,startCell:{...t},endRow:t.row}),this.domManager.setCursor("crosshair"),d("log",this.options.verbose,"Started dragging fill handle from",t))}handleFillHandleMouseMove(t){if(!this.stateManager.isDraggingFillHandle())return;const e=this.stateManager.getDragStartCell();if(!e||e.row===null)return;const i=this.domManager.getCanvasBoundingClientRect(),n=t.clientY-i.top+this.stateManager.getScrollTop(),s=this.options.headerHeight,r=this.stateManager.getRowHeights(),a=this.stateManager.getData().length;let o=null,l=s;for(let c=0;c<a;c++){const f=r[c];if(n>=l&&n<l+f){o=c;break}if(l+=f,l>n)break}let h=this.stateManager.getDragEndRow();o!==null?h=o:n<s?h=0:h=a-1,h!==this.stateManager.getDragEndRow()&&(this.stateManager.setDragState({isDragging:!0,startCell:e,endRow:h}),this.renderer.draw())}endFillHandleDrag(){if(!this.stateManager.isDraggingFillHandle())return;const t=this.stateManager.getDragEndRow();d("log",this.options.verbose,"Finished dragging fill handle to row",t),this._performFill(),this.stateManager.setDragState({isDragging:!1,startCell:null,endRow:null})}_performFill(){const t=this.stateManager.getDragState();if(!t.isDragging||!t.startCell||t.endRow===null||t.startCell.row===null)return;const e=t.startCell,i=t.endRow,n=e.row,s=e.col;if(s===null||n===null)return;const r=this.stateManager.getCellData(n,s),a=this.stateManager.getSchemaForColumn(s),o=this.stateManager.getColumnKey(s),l=a==null?void 0:a.type;let h=!1;const c=this.stateManager.getData().length,f=i>=n,m=f?n+1:i,p=f?i:n-1,C=[];for(let w=m;w<=p;w++){if(w<0||w>=c)continue;const u=this.stateManager.getSchemaForColumn(s);if(this.stateManager.isCellDisabled(w,s)){d("log",this.options.verbose,`Skipping fill for disabled cell ${w},${s}`);continue}if((u==null?void 0:u.type)!==l){d("log",this.options.verbose,`Skipping fill for row ${w}: Type mismatch (Source: ${l}, Target: ${u==null?void 0:u.type})`);continue}this.stateManager.getCellData(w,s)!==r&&(this.stateManager.updateCellInternal(w,s,r),C.push(w),h=!0)}h&&this.renderer.draw(),C.length>0&&this._batchUpdateCellsAndNotify(C,[o])}_batchUpdateCellsAndNotify(t,e){if(!t||t.length===0)return;const i=[];t.forEach(n=>{this.stateManager.updateDisabledStatesForRow(n),i.push({rowIndex:n,columnKeys:e,data:this.stateManager.getRowData(n)})}),i.length>0&&this.stateManager.callOnCellsUpdate(i)}copy(){var n,s,r;const t=this.stateManager.getActiveCell(),e=this.stateManager.getNormalizedSelectionRange();let i=!1;if(e){const{start:a,end:o}=e,l=[];let h=!0,c;for(let f=a.row;f<=o.row;f++){const m=[];for(let p=a.col;p<=o.col;p++){const C=this.stateManager.getCellData(f,p);m.push(C);const w=(n=this.stateManager.getSchemaForColumn(p))==null?void 0:n.type;f===a.row&&p===a.col?c=w:w!==c&&(h=!1)}l.push(m)}h||d("warn",this.options.verbose,"Copied range contains mixed data types."),i=this.stateManager.setCopiedRange(l,e),d("log",this.options.verbose,`Copied range data [${l.length}x${(s=l[0])==null?void 0:s.length}] from source range [${a.row},${a.col}] -> [${o.row},${o.col}]`)}else if(t&&t.row!==null&&t.col!==null){const{row:a,col:o}=t,l=this.stateManager.getCellData(a,o),h=(r=this.stateManager.getSchemaForColumn(o))==null?void 0:r.type;i=this.stateManager.setCopiedValue(l,h,{...t}),i&&d("log",this.options.verbose,`Copied value: ${l} (Type: ${h}) from cell ${a},${o}`)}return i}paste(){if(this.lastPasteHandledAt&&Date.now()-this.lastPasteHandledAt.getTime()<1e3)return!1;this.lastPasteHandledAt=new Date,d("log",this.options.verbose,"Paste requested by keyboard shortcut");const t=this.stateManager.getActiveCell(),e=this.stateManager.getNormalizedSelectionRange(),i=this.stateManager.getCopiedValue(),n=this.stateManager.getCopiedValueType(),s=this.stateManager.getCopiedRangeData(),r=e,a=!r&&t?t:null;return!r&&!a?(d("log",this.options.verbose,"Paste ignored: No target cell or range selected."),!1):s?(d("log",this.options.verbose,"Pasting range data"),r?this._pasteRangeToRange(r,s):a&&a.row!==null&&a.col!==null?this._pasteRangeFromTopLeft(a,s):!1):i!==void 0?(d("log",this.options.verbose,"Pasting single value"),r?this._pasteSingleValueToRange(r,i,n):a&&a.row!==null&&a.col!==null?this._pasteSingleValue(a,i,n):!1):(d("log",this.options.verbose,"Nothing to paste."),!1)}_pasteSingleValue(t,e,i){if(t.row===null||t.col===null)return!1;const n=t.row,s=t.col,r=this.stateManager.getColumnKey(s),a=this.stateManager.getSchemaForColumn(s);if(this.stateManager.isCellDisabled(n,s))return d("log",this.options.verbose,`Paste cancelled: Target cell ${n},${s} is disabled.`),!1;if((a==null?void 0:a.type)!==i&&e!==null){d("log",this.options.verbose,`Type mismatch (Copied: ${i}, Target: ${a==null?void 0:a.type}) - attempting conversion.`);const l=this._convertValueForTargetType(e,a);if(l===null)return d("log",this.options.verbose,"Paste cancelled: Cannot convert value between types."),!1;e=l}return k(e,a,r,this.options.verbose)?this.stateManager.getCellData(n,s)!==e?(this.stateManager.updateCellInternal(n,s,e),this._batchUpdateCellsAndNotify([n],[r]),d("log",this.options.verbose,`Pasted value ${e} to cell ${n},${s}`),!0):!1:(d("log",this.options.verbose,"Paste cancelled: Copied value failed validation for target cell."),!1)}_pasteSingleValueToRange(t,e,i){let n=!1;const s=[],r=[];for(let a=t.start.row;a<=t.end.row;a++)for(let o=t.start.col;o<=t.end.col;o++){const l=this.stateManager.getColumnKey(o),h=this.stateManager.getSchemaForColumn(o);if(this.stateManager.isCellDisabled(a,o))continue;let c=e;if((h==null?void 0:h.type)!==i&&e!==null&&(c=this._convertValueForTargetType(e,h),c===null))continue;if(!k(c,h,l,this.options.verbose)){d("warn",this.options.verbose,`Paste single to range: Value validation failed for cell ${a},${o}. Skipping.`);continue}this.stateManager.getCellData(a,o)!==c&&(this.stateManager.updateCellInternal(a,o,c),s.push(a),r.push(l),n=!0)}return s.length>0&&this._batchUpdateCellsAndNotify(s,r),n&&d("log",this.options.verbose,`Pasted single value to range [${t.start.row},${t.start.col}] -> [${t.end.row},${t.end.col}]`),n}_convertValueForTargetType(t,e){const i=e==null?void 0:e.type;if(t==null||i===void 0)return null;if(i==="text"||i==="email")return String(t);const n=String(t).trim();if(n==="")return null;switch(i){case"number":const s=parseFloat(n);return isNaN(s)?null:s;case"boolean":if(typeof t=="boolean")return t;const r=n.toLowerCase();return["true","yes","1","y"].includes(r)?!0:["false","no","0","n"].includes(r)?!1:null;case"date":if(t instanceof Date)return t.toISOString().split("T")[0];try{const a=new Date(t);if(!isNaN(a.getTime()))return a.toISOString().split("T")[0]}catch{}return null;case"select":if(e!=null&&e.values){let a=e.values.find(o=>String(o.id)===n);return a||(a=e.values.find(o=>o.name.toLowerCase()===n.toLowerCase())),a?a.id:null}return null;default:return null}}_pasteExternalSingleValue(t,e){if(t.row===null||t.col===null)return!1;const i=this.stateManager.getSchemaForColumn(t.col),n=this._convertValueForTargetType(e,i);return n===null?(d("log",this.options.verbose,"External paste cancelled: Cannot convert value for target cell type."),!1):this._pasteSingleValue(t,n,i==null?void 0:i.type)}_pasteRangeFromTopLeft(t,e){var f;if(t.row===null||t.col===null||!e||e.length===0)return!1;const i=t.row,n=t.col,s=e.length,r=((f=e[0])==null?void 0:f.length)||0;let a=!1;const o=this.stateManager.getData().length,l=this.stateManager.getColumns().length,h=[],c=new Set;for(let m=0;m<s;m++){const p=i+m;if(p>=o)break;const C=e[m];let w=!1;for(let u=0;u<r;u++){const M=n+u;if(M>=l)break;const S=C[u],b=this.stateManager.getColumnKey(M),y=this.stateManager.getSchemaForColumn(M);if(this.stateManager.isCellDisabled(p,M))continue;let v=S;if(v!==null&&(v=this._convertValueForTargetType(S,y),v===null))continue;if(!k(v,y,b,this.options.verbose)){d("warn",this.options.verbose,`Paste range from TL: Value validation failed for cell ${p},${M}. Skipping.`);continue}this.stateManager.getCellData(p,M)!==v&&(this.stateManager.updateCellInternal(p,M,v),w=!0,c.add(b))}w&&(h.push(p),a=!0)}return h.length>0&&this._batchUpdateCellsAndNotify(h,Array.from(c)),a&&d("log",this.options.verbose,`Pasted range [${s}x${r}] starting at ${i},${n}`),a}_pasteRangeToRange(t,e){var o;if(!e||e.length===0)return!1;const i=e.length,n=((o=e[0])==null?void 0:o.length)||0;if(n===0)return!1;let s=!1;const r=[],a=new Set;for(let l=t.start.row;l<=t.end.row;l++){let h=!1;for(let c=t.start.col;c<=t.end.col;c++){const f=(l-t.start.row)%i,m=(c-t.start.col)%n,p=e[f][m],C=this.stateManager.getColumnKey(c),w=this.stateManager.getSchemaForColumn(c);if(this.stateManager.isCellDisabled(l,c))continue;let u=p;if(u!==null&&(u=this._convertValueForTargetType(p,w),u===null))continue;if(!k(u,w,C,this.options.verbose)){d("warn",this.options.verbose,`Paste range to range: Value validation failed for cell ${l},${c}. Skipping.`);continue}this.stateManager.getCellData(l,c)!==u&&(this.stateManager.updateCellInternal(l,c,u),h=!0,a.add(C))}h&&(r.push(l),s=!0)}return r.length>0&&this._batchUpdateCellsAndNotify(r,Array.from(a)),s&&d("log",this.options.verbose,`Pasted range pattern into target range [${t.start.row},${t.start.col}] -> [${t.end.row},${t.end.col}]`),s}clearCopiedCell(){return this.stateManager.clearCopyState()}deleteSelectedRows(){const t=this.stateManager.getSelectedRows();if(t.size===0)return!1;const e=Array.from(t).sort((n,s)=>s-n);return d("log",this.options.verbose,"Deleting rows:",e),this.stateManager.deleteRows(e)>0?(this.clearSelections(),this.stateManager.setActiveCell(null),this.clearCopiedCell(),this.dimensionCalculator.initializeSizes(this.stateManager.getData().length),this.dimensionCalculator.calculateDimensions(this.stateManager.getViewportWidth(),this.stateManager.getViewportHeight()),this.domManager.updateCanvasSize(this.stateManager.getTotalContentWidth(),this.stateManager.getTotalContentHeight()),!0):!1}startSelectionDrag(t){if(t.row===null||t.col===null)return!1;let e=!1;this.stateManager.setDraggingSelection(!0);const i=this.stateManager.setActiveCell(t),n=this.stateManager.setSelectionRange(t,t);e=i||n;let s=!1;return e&&(s=this.clearSelections()),e||s?(d("log",this.options.verbose,`Started selection drag at ${t.row},${t.col}`),!0):!1}updateSelectionDrag(t){if(!this.stateManager.getIsDraggingSelection()||!this.stateManager.getSelectionStartCell()||t.row===null||t.col===null)return!1;const e=this.stateManager.getSelectionEndCell();return(e==null?void 0:e.row)!==t.row||(e==null?void 0:e.col)!==t.col?(d("log",this.options.verbose,`Updating selection drag to ${t.row},${t.col}`),this.stateManager.setSelectionRange(this.stateManager.getSelectionStartCell(),t)):!1}endSelectionDrag(){this.stateManager.getIsDraggingSelection()&&(d("log",this.options.verbose,`Ended selection drag. Final range: ${JSON.stringify(this.stateManager.getNormalizedSelectionRange())}`),this.stateManager.setDraggingSelection(!1))}moveActiveCell(t,e,i=!0){if(!this.editingManager)return d("warn",this.options.verbose,"EditingManager not set, cannot move active cell."),!1;const n=this.stateManager.getActiveCell();if(!n||n.row===null||n.col===null)return!1;let s=n.row,r=n.col;const a=this.stateManager.getData().length,o=this.stateManager.getColumns().length;let l=s+t,h=r+e;if(h>=o?(h=0,l++):h<0&&(h=o-1,l--),l<0||l>=a)return this.editingManager.deactivateEditor(!0),this.stateManager.setActiveCell(null),d("log",this.options.verbose,"Reached grid boundary, deactivating editor."),!0;let c=0;const f=a*o;for(;this.stateManager.isCellDisabled(l,h)&&c<f;)if(c++,l+=t,h+=e,h>=o?(h=0,l++):h<0&&(h=o-1,l--),l<0||l>=a)return this.editingManager.deactivateEditor(!0),this.stateManager.setActiveCell(null),d("warn",this.options.verbose,"Could not find next editable cell in direction."),!0;return c>=f?(d("warn",this.options.verbose,"Max search limit reached while finding next editable cell."),this.editingManager.deactivateEditor(!0),this.stateManager.setActiveCell(null),!0):(this.stateManager.setActiveCell({row:l,col:h}),i&&this.editingManager.activateEditor(l,h),!0)}pasteSingleValueExternal(t,e){if(t.row===null||t.col===null)return!1;const i=this.stateManager.getSchemaForColumn(t.col);return(i==null?void 0:i.type)!=="text"?(d("log",this.options.verbose,`Clipboard paste cancelled: Target cell ${t.row},${t.col} is not type 'text'.`),!1):this._pasteSingleValue(t,e,"text")}pasteRangeFromTopLeftExternal(t,e){var f;if(t.row===null||t.col===null||!e||e.length===0)return!1;const i=t.row,n=t.col,s=e.length,r=((f=e[0])==null?void 0:f.length)||0;let a=!1;const o=this.stateManager.getData().length,l=this.stateManager.getColumns().length,h=[],c=new Set;for(let m=0;m<s;m++){const p=i+m;if(p>=o)break;const C=e[m];let w=!1;for(let u=0;u<r;u++){const M=n+u;if(M>=l)break;const S=C[u],b=this.stateManager.getColumnKey(M),y=this.stateManager.getSchemaForColumn(M);if(this.stateManager.isCellDisabled(p,M))continue;if((y==null?void 0:y.type)!=="text"){d("log",this.options.verbose,`Clipboard paste range: Target cell ${p},${M} is not type 'text'. Skipping.`);continue}if(!k(S,y,b,this.options.verbose)){d("warn",this.options.verbose,`Clipboard paste range TL: Value validation failed for cell ${p},${M}. Skipping.`);continue}this.stateManager.getCellData(p,M)!==S&&(this.stateManager.updateCellInternal(p,M,S),w=!0,c.add(b))}w&&(h.push(p),a=!0)}return h.length>0&&this._batchUpdateCellsAndNotify(h,Array.from(c)),a&&d("log",this.options.verbose,`Pasted external range [${s}x${r}] starting at ${i},${n}`),a}pasteRangeToRangeExternal(t,e){var o;if(!e||e.length===0)return!1;const i=e.length,n=((o=e[0])==null?void 0:o.length)||0;if(n===0)return!1;let s=!1;const r=[],a=new Set;for(let l=t.start.row;l<=t.end.row;l++){let h=!1;for(let c=t.start.col;c<=t.end.col;c++){const f=(l-t.start.row)%i,m=(c-t.start.col)%n,p=e[f][m],C=this.stateManager.getColumnKey(c),w=this.stateManager.getSchemaForColumn(c);if(this.stateManager.isCellDisabled(l,c))continue;const u=this._convertValueForTargetType(p,w);if(u===null)continue;if(!k(u,w,C,this.options.verbose)){d("warn",this.options.verbose,`External paste range->range: Value validation failed for cell ${l},${c}. Skipping.`);continue}this.stateManager.getCellData(l,c)!==u&&(this.stateManager.updateCellInternal(l,c,u),h=!0,a.add(C))}h&&(r.push(l),s=!0)}return r.length>0&&this._batchUpdateCellsAndNotify(r,Array.from(a)),s&&d("log",this.options.verbose,`Pasted external range pattern into target range [${t.start.row},${t.start.col}] -> [${t.end.row},${t.end.col}]`),s}pasteToColumnExternal(t,e){d("log",this.options.verbose,`External paste to entire column ${t}`);const i=this.stateManager.getSchemaForColumn(t),n=this.stateManager.getData();let s=!1;if(e==null)return d("log",this.options.verbose,"No value to paste to column"),!1;const r=this._convertValueForTargetType(e,i),a=[];for(let o=0;o<n.length;o++){if(this.stateManager.isCellDisabled(o,t))continue;this.stateManager.getCellData(o,t)!==r&&(this.stateManager.updateCellInternal(o,t,r),s=!0,a.push(o))}return s&&(this._batchUpdateCellsAndNotify(a,[this.stateManager.getColumnKey(t)]),this.renderer.draw()),s}}class Rt{constructor(t,e,i){this.columnWidths=[],this.rowHeights=[],this.scrollTop=0,this.scrollLeft=0,this.viewportWidth=0,this.viewportHeight=0,this.totalContentWidth=0,this.totalContentHeight=0,this.visibleRowStartIndex=0,this.visibleRowEndIndex=0,this.visibleColStartIndex=0,this.visibleColEndIndex=0,this.activeCell=null,this.selectionStartCell=null,this.selectionEndCell=null,this.isDraggingSelection=!1,this.activeEditor=null,this.selectedRows=new Set,this.lastClickedRow=null,this.selectedColumn=null,this.copiedValue=void 0,this.copiedValueType=void 0,this.copiedCell=null,this.copiedRangeData=null,this.copiedSourceRange=null,this.dragState={isDragging:!1,startCell:null,endRow:null},this.resizeColumnState={isResizing:!1,columnIndex:null,startX:null},this.resizeRowState={isResizing:!1,rowIndex:null,startY:null},this.schema=t,this.columns=Object.keys(t),this.data=[],this.options=i}setInitialData(t){this.data=JSON.parse(JSON.stringify(t||[])),this._updateAllDisabledStates()}getData(){return JSON.parse(JSON.stringify(this.data,(t,e)=>{if(!(typeof t=="string"&&t.startsWith(X)))return e}))}setData(t){this.data=JSON.parse(JSON.stringify(t||[])),this._updateAllDisabledStates(),this.resetInteractionState()}clearAllSelections(){this.activeCell=null,this.selectionStartCell=null,this.selectionEndCell=null,this.isDraggingSelection=!1,this.selectedRows=new Set,this.selectedColumn=null,this.lastClickedRow=null,this.copiedValue=void 0,this.copiedValueType=void 0,this.copiedCell=null}updateCellInternal(t,e,i){if(t>=0&&t<this.data.length&&e>=0&&e<this.columns.length){const n=this.columns[e];this.data[t]||(this.data[t]={}),this.data[t][n]=i}else d("warn",this.options.verbose,`updateCellInternal: Invalid coordinates (${t}, ${e})`)}updateCell(t,e,i){if(t<0||t>=this.data.length)return d("warn",this.options.verbose,`updateCell: Invalid row index (${t}).`),!1;if(e.includes(":"))return this.data[t][e]=i,!0;if(this.columns.indexOf(e)<0)return d("warn",this.options.verbose,`updateCell: Invalid column key (${e}).`),!1;const s=this.schema[e];if(k(i,s,e,this.options.verbose)){if(this.data[t]||(this.data[t]={}),this.data[t][e]!==i)return this.data[t][e]=i,this.updateDisabledStatesForRow(t),!0}else d("warn",this.options.verbose,`updateCell: Validation failed for ${e}. Value not set.`);return!1}getCellData(t,e){var n;if(t<0||t>=this.data.length||e<0||e>=this.columns.length)return;const i=this.columns[e];return(n=this.data[t])==null?void 0:n[i]}getRowData(t){return this.data[t]}deleteRows(t){let e=0;return t.sort((n,s)=>s-n).forEach(n=>{n>=0&&n<this.data.length&&(this.data.splice(n,1),n<this.rowHeights.length&&this.rowHeights.splice(n,1),e++)}),e>0&&this._updateAllDisabledStates(),e}getSchema(){return this.schema}getColumns(){return this.columns}getColumnKey(t){return this.columns[t]}getSchemaForColumn(t){const e=this.columns[t];return e?this.schema[e]:void 0}getColumnWidths(){return this.columnWidths}setColumnWidths(t){this.columnWidths=t}getRowHeights(){return this.rowHeights}setRowHeights(t){this.rowHeights=t}getTotalContentWidth(){return this.totalContentWidth}getTotalContentHeight(){return this.totalContentHeight}updateViewportSize(t,e){this.viewportWidth=t,this.viewportHeight=e}getViewportWidth(){return this.viewportWidth}getViewportHeight(){return this.viewportHeight}updateTotalContentSize(t,e){this.totalContentWidth=t,this.totalContentHeight=e}updateScroll(t,e){this.scrollTop=t,this.scrollLeft=e}getScrollTop(){return this.scrollTop}getScrollLeft(){return this.scrollLeft}updateVisibleRange(t,e,i,n){this.visibleRowStartIndex=t,this.visibleRowEndIndex=e,this.visibleColStartIndex=i,this.visibleColEndIndex=n}getVisibleRowStartIndex(){return this.visibleRowStartIndex}getVisibleRowEndIndex(){return this.visibleRowEndIndex}getVisibleColStartIndex(){return this.visibleColStartIndex}getVisibleColEndIndex(){return this.visibleColEndIndex}getActiveCell(){return this.activeCell}setActiveCell(t){const e=JSON.stringify(this.activeCell)!==JSON.stringify(t);return e&&(this.activeCell=t),e}getActiveEditor(){return this.activeEditor}setActiveEditor(t){this.activeEditor=t}getSelectedRows(){return this.selectedRows}setSelectedRows(t,e){const i=JSON.stringify(Array.from(this.selectedRows).sort((o,l)=>o-l)),n=JSON.stringify(Array.from(t).sort((o,l)=>o-l)),s=i!==n,r=this.lastClickedRow!==e,a=s||r;return a&&(this.selectedRows=new Set(t),this.lastClickedRow=e),a}getLastClickedRow(){return this.lastClickedRow}getSelectedColumn(){return this.selectedColumn}setSelectedColumn(t){const e=this.selectedColumn!==t;return e&&(this.selectedColumn=t),e}getCopiedValue(){return this.copiedValue}getCopiedValueType(){return this.copiedValueType}getCopiedCell(){return this.copiedCell}setCopiedValue(t,e,i){const n=JSON.stringify(this.copiedCell)!==JSON.stringify(i),s=this.copiedRangeData!==null,r=this.copiedSourceRange!==null;return this.copiedValue=t,this.copiedValueType=e,this.copiedCell=i,this.copiedRangeData=null,this.copiedSourceRange=null,n||s||r}setCopiedRange(t,e){const i=JSON.stringify(this.copiedRangeData)!==JSON.stringify(t),n=JSON.stringify(this.copiedSourceRange)!==JSON.stringify(e),s=this.copiedCell!==null;return this.copiedRangeData=t,this.copiedSourceRange=e,this.copiedValue=void 0,this.copiedValueType=void 0,this.copiedCell=null,i||n||s}getCopiedRangeData(){return this.copiedRangeData}getCopiedSourceRange(){return this.copiedSourceRange}isCopyActive(){return this.copiedCell!==null||this.copiedRangeData!==null}clearCopyState(){return this.setCopiedValue(void 0,void 0,null)}getDragState(){return this.dragState}setDragState(t){this.dragState=t}isDraggingFillHandle(){return this.dragState.isDragging}getDragStartCell(){return this.dragState.startCell}getDragEndRow(){return this.dragState.endRow}getResizeColumnState(){return this.resizeColumnState}setResizeColumnState(t){this.resizeColumnState=t}getResizeRowState(){return this.resizeRowState}setResizeRowState(t){this.resizeRowState=t}isResizing(){return this.resizeColumnState.isResizing||this.resizeRowState.isResizing}resetInteractionState(){this.activeCell=null,this.selectionStartCell=null,this.selectionEndCell=null,this.isDraggingSelection=!1,this.activeEditor=null,this.selectedRows=new Set,this.selectedColumn=null,this.lastClickedRow=null,this.copiedValue=void 0,this.copiedValueType=void 0,this.copiedCell=null,this.copiedRangeData=null,this.copiedSourceRange=null,this.dragState={isDragging:!1,startCell:null,endRow:null},this.resizeColumnState={isResizing:!1,columnIndex:null,startX:null},this.resizeRowState={isResizing:!1,rowIndex:null,startY:null}}isCellDisabled(t,e){if(t<0||t>=this.data.length||e<0||e>=this.columns.length)return!0;const i=this.columns[e],n=this.data[t];return!!(n!=null&&n[`${X}${i}`])}updateDisabledStatesForRow(t){if(t<0||t>=this.data.length)return!1;const e=this.data[t];if(!e)return!1;let i=!1;return this.columns.forEach(n=>{const s=`${X}${n}`,r=!!e[s],a=this.options.isCellDisabled?this.options.isCellDisabled(t,n,e):!1;r!==a&&(e[s]=a,i=!0)}),i}callOnCellsUpdate(t){var e,i;(i=(e=this.options).onCellsUpdate)==null||i.call(e,t)}_updateAllDisabledStates(){d("log",this.options.verbose,"Updating all disabled states..."),this.data.forEach((t,e)=>{this.updateDisabledStatesForRow(e)}),d("log",this.options.verbose,"Finished updating all disabled states.")}getSelectionStartCell(){return this.selectionStartCell}getSelectionEndCell(){return this.selectionEndCell}setSelectionRange(t,e){const i=JSON.stringify(this.selectionStartCell)!==JSON.stringify(t),n=JSON.stringify(this.selectionEndCell)!==JSON.stringify(e),s=i||n;return s&&(this.selectionStartCell=t,this.selectionEndCell=e),s}clearSelectionRange(){return this.setSelectionRange(null,null)}getNormalizedSelectionRange(){if(!this.selectionStartCell||!this.selectionEndCell||this.selectionStartCell.row===null||this.selectionStartCell.col===null||this.selectionEndCell.row===null||this.selectionEndCell.col===null)return null;const t=Math.min(this.selectionStartCell.row,this.selectionEndCell.row),e=Math.min(this.selectionStartCell.col,this.selectionEndCell.col),i=Math.max(this.selectionStartCell.row,this.selectionEndCell.row),n=Math.max(this.selectionStartCell.col,this.selectionEndCell.col);return{start:{row:t,col:e},end:{row:i,col:n}}}isMultiCellSelectionActive(){return!!this.selectionStartCell&&!!this.selectionEndCell}setDraggingSelection(t){this.isDraggingSelection=t}getIsDraggingSelection(){return this.isDraggingSelection}addRow(){const t={};this.columns.forEach(i=>{if(i.includes(X))return;const n=this.schema[i];let s=null;if(n)switch(n.type){case"text":case"email":s="";break;case"number":s=0;break;case"boolean":s=!1;break;default:s=null}t[i]=s}),this.data.push(t);const e=this.data.length-1;return this.updateDisabledStatesForRow(e),e}addColumn(t,e){const i=`custom:${t}`;if(this.schema[i])throw new Error(`Column ${t} already exists`);const n=this.columns.length;return this.columns.push(i),this.columnWidths.push(this.options.defaultColumnWidth),this.schema[i]=e,n}removeColumn(t){const e=this.columns[t];this.clearAllSelections(),delete this.schema[e],this.columns.splice(t,1),this.columnWidths.splice(t,1),this.data.forEach(i=>{delete i[e]})}}class xt{constructor(t,e,i=[],n={}){const s=document.getElementById(t);if(!s)throw new Error(`Container element with ID "${t}" not found.`);this.container=s,this.options={...ft,...n},this.stateManager=new Rt(e,i,this.options),this.domManager=new pt(this.container),this.dimensionCalculator=new Mt(this.options,this.stateManager,this.domManager),this.renderer=new St(this.domManager.getContext(),this.options,this.stateManager,this.dimensionCalculator),this.interactionManager=new vt(this.options,this.stateManager,this.renderer,this.dimensionCalculator,this.domManager),this.editingManager=new yt(this.container,this.options,this.stateManager,this.domManager,this.renderer,this.interactionManager),this.eventManager=new bt(this.container,this.editingManager,this.interactionManager,this.stateManager,this.dimensionCalculator,this.renderer,this.options,this.domManager),this.stateManager.setInitialData(i),this.dimensionCalculator.initializeSizes(i.length),this.domManager.setup(this.stateManager.getTotalContentWidth(),this.stateManager.getTotalContentHeight()),this.dimensionCalculator.calculateDimensions(this.container.clientWidth,this.container.clientHeight),this.eventManager.bindEvents(r=>{r.type==="resize"&&this.onDataUpdate()}),this.draw(),d("log",this.options.verbose,"Spreadsheet initialized")}draw(){this.stateManager.updateScroll(this.domManager.getVScrollPosition(),this.domManager.getHScrollPosition()),this.dimensionCalculator.calculateVisibleRange(),this.renderer.draw()}onDataUpdate(t=0,e=0){this.dimensionCalculator.initializeSizes(this.stateManager.getData().length),this.domManager.updateCanvasSize(this.stateManager.getTotalContentWidth(),this.stateManager.getTotalContentHeight()),this.dimensionCalculator.calculateDimensions(this.container.clientWidth,this.container.clientHeight),this.interactionManager.moveScroll(e,t,!0),this.draw()}getData(){return this.stateManager.getData()}setData(t){this.stateManager.setData(t),this.onDataUpdate()}addRow(){const t=this.stateManager.addRow();return this.onDataUpdate(this.container.scrollHeight,0),t}addColumn(t,e){const i=this.stateManager.addColumn(t,e);return this.onDataUpdate(0,this.container.scrollWidth),i}updateCell(t,e,i){this.stateManager.updateCell(t,e,i)&&this.draw()}redraw(){this.draw()}}const Dt={id:{type:"number",decimal:!1,label:"ID"},name:{type:"text",required:!0,maxlength:50,label:"Full Name"},email:{type:"email",required:!0,label:"Email Address"},dob:{type:"date",label:"Date of Birth"},locationId:{type:"select",label:"Location",values:[{id:1,name:"New York"},{id:2,name:"London"},{id:3,name:"Tokyo"},{id:4,name:"Paris"},{id:5,name:"Sydney"},{id:6,name:"Berlin"},{id:7,name:"Cairo"},{id:8,name:"Rio de Janeiro"},{id:9,name:"Moscow"},{id:10,name:"Beijing"}]},isRestricted:{type:"boolean",label:"Restricted"},salary:{type:"number",label:"Salary"},notes:{type:"text",label:"Notes"}};function Tt(g){return Array.from({length:g},(t,e)=>({id:e+1,name:`Person ${e+1}`,email:`person${e+1}@example.com`,dob:Math.random()<.5?null:new Date(Math.floor(Math.random()*1e10)).toISOString().split("T")[0],locationId:Math.random()<.5?null:Math.floor(Math.random()*10)+1,isRestricted:Math.random()<.5,salary:Math.floor(Math.random()*1e5)+5e4,notes:`Notes for Person ${e+1}`}))}const ot=window.location.search.includes("bigdata")?Tt(2e4):[{id:1,name:"Alice Johnson",email:"alice@example.com",dob:"1990-05-15",locationId:1,isRestricted:!1,salary:75e3,notes:"Team Lead"},{id:2,name:"Bob Smith",email:"bob@sample.net",dob:"1985-11-22",locationId:null,isRestricted:!0,salary:12e4,notes:"Senior Developer"},{id:3,name:"Charlie Brown",email:"charlie@testing.org","error:email":"Invalid email",dob:"1998-02-10",locationId:2,isRestricted:!1,salary:55e3,notes:""},{id:4,name:"Diana Prince",email:"diana@example.com",dob:"1980-08-08",locationId:5,isRestricted:!1,salary:95e3,notes:"Project Manager"},{id:5,name:"Ethan Hunt",email:"ethan@sample.net",dob:"1992-07-19",locationId:1,isRestricted:!0,salary:88e3,notes:"Needs access review"},{id:6,name:"Fiona Gallagher",email:"fiona@testing.org",dob:"1995-03-30",locationId:4,isRestricted:!1,salary:62e3,notes:"Junior Staff"},{id:7,name:"George Costanza",email:"george@example.com",dob:"1975-12-01",locationId:1,isRestricted:!1,salary:4e4,notes:"Part-time consultant"},{id:8,name:"Hannah Abbott",email:"hannah@sample.net",dob:"2000-01-25",locationId:2,isRestricted:!1,salary:58e3,notes:null},{id:9,name:"Ian Malcolm",email:"ian@testing.org",dob:"1978-09-14",locationId:7,isRestricted:!0,salary:15e4,notes:"Consultant - High Risk"},{id:10,name:"Jane Doe",email:"jane@example.com",dob:"1993-06-05",locationId:8,isRestricted:!1,salary:72e3,notes:"Standard user"},{id:11,name:"Kyle Broflovski",email:"kyle@sample.net",dob:"1999-05-26",locationId:9,isRestricted:!1,salary:68e3,notes:""},{id:12,name:"Laura Palmer",email:"laura@testing.org",dob:"1988-07-22",locationId:10,isRestricted:!0,salary:11e4,notes:"Requires monitoring"},{id:13,name:"Michael Scott",email:"michael@example.com",dob:"1970-03-15",locationId:1,isRestricted:!1,salary:85e3,notes:"Regional Manager"},{id:14,name:"Nadia Petrova",email:"nadia@sample.net",dob:"1982-11-08",locationId:9,isRestricted:!0,salary:13e4,notes:"Security clearance needed"},{id:15,name:"Oscar Martinez",email:"oscar@testing.org",dob:"1984-01-12",locationId:1,isRestricted:!1,salary:78e3,notes:"Accountant"},{id:16,name:"Pam Beesly",email:"pam@example.com",dob:"1989-03-25",locationId:1,isRestricted:!1,salary:6e4,notes:"Receptionist"},{id:17,name:"Quentin Coldwater",email:"quentin@sample.net",dob:"1996-09-01",locationId:3,isRestricted:!1,salary:65e3,notes:""},{id:18,name:"Rachel Green",email:"rachel@testing.org",dob:"1987-05-05",locationId:1,isRestricted:!1,salary:7e4,notes:"Fashion Buyer"},{id:19,name:"Steve Rogers",email:"steve@example.com",dob:"1920-07-04",locationId:1,isRestricted:!0,salary:2e5,notes:"Special Project"},{id:20,name:"Tony Stark",email:"tony@sample.net",dob:"1970-05-29",locationId:1,isRestricted:!0,salary:5e5,notes:"CEO - Restricted Access"},{id:21,name:"Ursula Buffay",email:"ursula@testing.org",dob:"1987-05-05",locationId:1,isRestricted:!1,salary:45e3,notes:"Waitress"},{id:22,name:"Victor Frankenstein",email:"victor@example.com",dob:"1790-10-10",locationId:6,isRestricted:!0,salary:99e3,notes:"Research - Confidential"},{id:23,name:"Wendy Darling",email:"wendy@sample.net",dob:"1900-01-01",locationId:2,isRestricted:!1,salary:52e3,notes:""},{id:24,name:"Xavier Thorpe",email:"xavier@testing.org",dob:"2002-04-18",locationId:4,isRestricted:!1,salary:61e3,notes:"Artist"},{id:25,name:"Yvonne Strahovski",email:"yvonne@example.com",dob:"1982-07-30",locationId:5,isRestricted:!0,salary:14e4,notes:"Agent - Top Secret"},{id:26,name:"Zachary Levi",email:"zachary@sample.net",dob:"1980-09-29",locationId:1,isRestricted:!1,salary:1e5,notes:"Actor"}];function Et(g,t,e){return t==="locationId"&&e.isRestricted&&e.locationId===1}document.addEventListener("DOMContentLoaded",()=>{var t,e;document.getElementById("data-size").textContent=ot.length.toString();let g=null;try{g=new xt("spreadsheet-container",Dt,ot,{selectedRowBgColor:"#e0e7ff",isCellDisabled:Et,onCellsUpdate:i=>{const n=i[0];n.columnKeys.includes("email")&&n.data.email&&n.data.email.endsWith("@sample.net")&&(g==null||g.updateCell(n.rowIndex,"loading:email",!0),setTimeout(()=>{g==null||g.updateCell(n.rowIndex,"loading:email",null),g==null||g.updateCell(n.rowIndex,"error:email","error")},2e3))},verbose:!0}),setTimeout(()=>{console.log("data",g==null?void 0:g.getData())},2e3)}catch(i){console.error("Failed to initialize spreadsheet:",i);const n=document.getElementById("spreadsheet-container");n&&(n.innerHTML=`<p class="p-4 text-red-600">Error initializing spreadsheet: ${i instanceof Error?i.message:"Unknown error"}</p>`)}(t=document.getElementById("add-row"))==null||t.addEventListener("click",()=>{g==null||g.addRow()}),(e=document.getElementById("add-column"))==null||e.addEventListener("click",()=>{g==null||g.addColumn("new-column",{type:"text",label:"New Column"})})});
