(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))i(s);new MutationObserver(s=>{for(const n of s)if(n.type==="childList")for(const l of n.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&i(l)}).observe(document,{childList:!0,subtree:!0});function e(s){const n={};return s.integrity&&(n.integrity=s.integrity),s.referrerPolicy&&(n.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?n.credentials="include":s.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function i(s){if(s.ep)return;s.ep=!0;const n=e(s);fetch(s.href,n)}})();class J extends Error{constructor({errorMessage:t,rowIndex:e,colKey:i,value:s,schema:n,errorType:l}){super(t),this.rowIndex=e,this.colKey=i,this.value=s,this.schema=n,this.errorType=l}}const pt={defaultColumnWidth:150,defaultRowHeight:30,minColumnWidth:50,maxColumnWidth:500,minRowHeight:20,maxRowHeight:150,headerHeight:35,rowNumberWidth:50,font:"14px Inter, sans-serif",headerFont:"bold 14px Inter, sans-serif",padding:5,textAlign:"left",textBaseline:"middle",textColor:"#111827",placeholderTextColor:"#9ca3af",loadingTextColor:"#3b82f6",errorTextColor:"#b91c1c",cellBgColor:"#ffffff",activeCellBgColor:"#eff6ff",errorCellBgColor:"#fca5a5",selectedRowBgColor:"#f3f4f6",selectedRangeBgColor:"#e0e7ff",headerTextColor:"#ffffff",selectedHeaderTextColor:"#000000",headerBgColor:"#4b5563",customHeaderBgColor:"#9ca3af",selectedHeaderBgColor:"#dbeafe",headerClipText:!0,headerTextAlign:"center",gridLineColor:"#d1d5db",rowNumberBgColor:"#f3f4f6",selectedRowNumberBgColor:"#dbeafe",disabledCellBgColor:"#e5e7eb",disabledCellTextColor:"#9ca3af",highlightBorderColor:"#3b82f6",fillHandleColor:"#3b82f6",fillHandleSize:10,dragRangeBorderColor:"#6b7280",copyHighlightBorderColor:"#1f2937",copyHighlightBorderDash:[4,3],resizeHandleSize:5,temporaryErrorTimeout:2e3,customDatePicker:!1,verbose:!1},O="disabled:";class wt{constructor(t){this.systemScrollbarWidth=0,this.container=t,this.container.style.position="relative",this.container.tabIndex=-1,this.systemScrollbarWidth=this.getSystemScrollbarWidth()+1,this.canvas=document.createElement("canvas");const e=this.canvas.getContext("2d");if(!e)throw new Error("Failed to get 2D context from canvas");this.ctx=e,this.container.appendChild(this.canvas),this.hScrollbar=document.createElement("div"),this.hScrollbar.id="spreadsheet-hscrollbar",this.hScrollbar.style.position="absolute",this.hScrollbar.style.bottom="0",this.hScrollbar.style.left="0",this.hScrollbar.style.width=`calc(100% - ${this.systemScrollbarWidth}px)`,this.hScrollbar.style.overflow="auto",this.container.appendChild(this.hScrollbar),this.vScrollbar=document.createElement("div"),this.vScrollbar.id="spreadsheet-vscrollbar",this.vScrollbar.style.position="absolute",this.vScrollbar.style.right="0",this.vScrollbar.style.top="0",this.vScrollbar.style.width=`${this.systemScrollbarWidth}px`,this.vScrollbar.style.height=`calc(100% - ${this.systemScrollbarWidth}px)`,this.vScrollbar.style.overflow="auto",this.container.appendChild(this.vScrollbar),this.editorInput=document.createElement("input"),this.editorInput.className="spreadsheet-editor",this.editorInput.style.position="absolute",this.editorInput.style.display="none",this.editorInput.style.boxSizing="border-box",this.container.appendChild(this.editorInput),this.dropdown=document.createElement("div"),this.dropdown.className="spreadsheet-dropdown",this.dropdown.style.position="absolute",this.dropdown.style.display="none",this.dropdown.style.zIndex="100",this.dropdown.style.border="1px solid #ccc",this.dropdown.style.backgroundColor="white",this.dropdown.style.boxShadow="0 2px 5px rgba(0,0,0,0.15)";const i=document.createElement("div");i.className="spreadsheet-dropdown-search",i.style.padding="5px",i.style.borderBottom="1px solid #eee",this.dropdownSearchInput=document.createElement("input"),this.dropdownSearchInput.type="text",this.dropdownSearchInput.placeholder="Search...",this.dropdownSearchInput.style.width="100%",this.dropdownSearchInput.style.boxSizing="border-box",this.dropdownSearchInput.style.padding="4px",i.appendChild(this.dropdownSearchInput),this.dropdownList=document.createElement("ul"),this.dropdownList.className="spreadsheet-dropdown-list",this.dropdownList.style.listStyle="none",this.dropdownList.style.margin="0",this.dropdownList.style.padding="0",this.dropdownList.style.maxHeight="200px",this.dropdownList.style.overflowY="auto",this.dropdown.appendChild(i),this.dropdown.appendChild(this.dropdownList),this.container.appendChild(this.dropdown)}getSystemScrollbarWidth(){var s;if(this.systemScrollbarWidth)return this.systemScrollbarWidth;const t=document.createElement("div");t.style.visibility="hidden",t.style.overflow="scroll",document.body.appendChild(t);const e=document.createElement("div");t.appendChild(e);const i=t.offsetWidth-t.clientWidth;return(s=t.parentNode)==null||s.removeChild(t),i}setup(t,e){this.updateCanvasSize(t,e)}updateCanvasSize(t,e){this.container.setAttribute("data-width",`${t}`),this.container.setAttribute("data-height",`${e}`),this.hScrollbar.innerHTML=`<div class="placeholder" style="width: ${t}px; height: 1px;"></div>`,this.vScrollbar.innerHTML=`<div class="placeholder" style="width: 1px; height: ${e}px;"></div>`;const i=this.container.clientWidth-this.systemScrollbarWidth,s=this.container.clientHeight-this.systemScrollbarWidth;this.canvas.width=i,this.canvas.height=s,this.canvas.style.width=`${i}px`,this.canvas.style.height=`${s}px`}getHScrollbar(){return this.hScrollbar}getVScrollbar(){return this.vScrollbar}getHScrollPosition(){return this.hScrollbar.scrollLeft}setHScrollPosition(t){return this.hScrollbar.scrollLeft=t,this.hScrollbar.scrollLeft}getVScrollPosition(){return this.vScrollbar.scrollTop}setVScrollPosition(t){return this.vScrollbar.scrollTop=t,this.vScrollbar.scrollTop}canVScrollUp(){return this.vScrollbar.scrollTop>0}canVScrollDown(){return this.vScrollbar.scrollTop+this.vScrollbar.clientHeight<this.vScrollbar.scrollHeight}canHScrollRight(){return this.hScrollbar.scrollLeft+this.hScrollbar.clientWidth<this.hScrollbar.scrollWidth}canHScrollLeft(){return this.hScrollbar.scrollLeft>0}getCanvas(){return this.canvas}getContext(){return this.ctx}getEditorInput(){return this.editorInput}getDropdownElements(){return{dropdown:this.dropdown,searchInput:this.dropdownSearchInput,list:this.dropdownList}}focusContainer(){this.container.focus()}setCursor(t){this.canvas.style.cursor=t}getCanvasBoundingClientRect(){return this.canvas.getBoundingClientRect()}}function g(M,t,...e){!t&&M!=="error"||console[M](...e)}function Ct(M,t,e){if(M==null)return"";switch(t){case"date":try{const i=String(M),s=M instanceof Date?M:new Date(i.includes("T")?i:i+"T00:00:00Z");if(!isNaN(s.getTime()))return s.toLocaleDateString(void 0,{timeZone:"UTC"})}catch(i){g("warn",!1,"Error formatting date value:",M,i)}return String(M);case"boolean":return M===!0?"True":M===!1?"False":"";case"select":if(e){const i=e.find(s=>s.id===M);return i?i.name:""}return"";case"number":return String(M);case"text":case"email":default:return String(M)}}function mt(M,t){if(M==null)return"";if(t==="date"){try{const e=String(M),i=M instanceof Date?M:new Date(e.includes("T")?e:e+"T00:00:00Z");if(!isNaN(i.getTime())){const s=i.getUTCFullYear(),n=(i.getUTCMonth()+1).toString().padStart(2,"0"),l=i.getUTCDate().toString().padStart(2,"0");return`${s}-${n}-${l}`}}catch(e){g("warn",!1,"Error formatting date for input:",M,e)}return""}return String(M)}function Mt(M,t){if(M==="")return null;switch(t){case"number":const e=parseFloat(M);return isNaN(e)?null:e;case"boolean":return M.toLowerCase()==="true";case"date":return M;case"text":case"email":default:return M}}function W(M,t,e,i){if(!t)return{success:!0};const s=t.label||e;if(t.required&&(M==null||M==="")){const n=`Column "${s}" is required.`;return g("warn",i,`Validation failed: ${n}.`),{success:!1,error:n,errorType:"required"}}if(M==null||M==="")return{success:!0};switch(t.type){case"text":if(t.maxlength&&typeof M=="string"&&M.length>t.maxlength){const n=`Column "${s}" exceeds max length of ${t.maxlength}.`;return g("warn",i,`Validation failed: ${n}.`),{success:!1,error:n,errorType:"maxlength"}}break;case"email":if(typeof M!="string"||!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(M)){const n=`Invalid email format for column "${s}".`;return g("warn",i,`Validation failed: ${n}.`),{success:!1,error:n,errorType:"value"}}break;case"number":if(typeof M!="number"){const n=`Column "${s}" expects a number.`;return g("warn",i,`Validation failed: ${n}.`),{success:!1,error:n,errorType:"value"}}if(t.decimal===!1&&!Number.isInteger(M)){const n=`Column "${s}" expects an integer.`;return g("warn",i,`Validation failed: ${n}.`),{success:!1,error:n,errorType:"value"}}break;case"date":if(typeof M!="string"||!/^\d{4}-\d{2}-\d{2}$/.test(M)||isNaN(new Date(M+"T00:00:00Z").getTime())){const n=`Invalid date format (YYYY-MM-DD) for column "${s}".`;return g("warn",i,`Validation failed: ${n}.`),{success:!1,error:n,errorType:"value"}}break;case"boolean":if(typeof M!="boolean"){const n=`Column "${s}" expects a boolean.`;return g("warn",i,`Validation failed: ${n}.`),{success:!1,error:n,errorType:"value"}}break;case"select":if(M!==null&&t.values&&!t.values.some(n=>n.id===M)){const n=`Invalid selection for column "${s}".`;return g("warn",i,`Validation failed: ${n}.`),{success:!1,error:n,errorType:"value"}}break}return{success:!0}}class St{constructor(t,e,i){this.options=t,this.stateManager=e,this.domManager=i}initializeSizes(t){const e=this.stateManager.getColumns().map(()=>this.options.defaultColumnWidth),i=Array(t).fill(this.options.defaultRowHeight);this.stateManager.setColumnWidths(e),this.stateManager.setRowHeights(i),g("log",this.options.verbose,"Initialized column widths:",e),g("log",this.options.verbose,"Initialized row heights:",i),this.calculateTotalSize()}calculateDimensions(t,e){const i=this.domManager.getSystemScrollbarWidth();this.stateManager.updateViewportSize(t-i,e-i),this.calculateTotalSize(),g("log",this.options.verbose,"Calculated Dimensions:",{totalContentWidth:this.stateManager.getTotalContentWidth(),totalContentHeight:this.stateManager.getTotalContentHeight(),viewportWidth:this.stateManager.getViewportWidth(),viewportHeight:this.stateManager.getViewportHeight()}),this.calculateVisibleRange()}calculateTotalSize(){let t=this.options.rowNumberWidth;this.stateManager.getColumnWidths().forEach(i=>t+=i);let e=this.options.headerHeight;this.stateManager.getRowHeights().forEach(i=>e+=i),this.stateManager.updateTotalContentSize(t,e)}calculateVisibleRange(){const{headerHeight:t,rowNumberWidth:e}=this.options,i=this.stateManager.getData(),s=this.stateManager.getColumns(),n=this.stateManager.getColumnWidths(),l=this.stateManager.getRowHeights(),r=this.stateManager.getScrollLeft(),o=this.stateManager.getScrollTop(),a=this.stateManager.getViewportWidth(),h=this.stateManager.getViewportHeight();let c=e,p=-1,d=s.length-1;for(let f=0;f<s.length;f++){const m=n[f],S=c+m;if(S>r&&c<r+a)p===-1&&(p=f),d=f;else if(p!==-1)break;c=S}p===-1&&(p=0,d=-1);let u=t,w=-1,C=i.length-1;for(let f=0;f<i.length;f++){const m=l[f],S=u+m;if(S>o&&u<o+h)w===-1&&(w=f),C=f;else if(w!==-1)break;u=S}w===-1&&(w=0,C=-1),this.stateManager.updateVisibleRange(w,C,p,d),g("log",this.options.verbose,"Calculated Visible Range:",{rows:`${w} - ${C}`,cols:`${p} - ${d}`})}getColumnLeft(t){let e=this.options.rowNumberWidth;const i=this.stateManager.getColumnWidths();for(let s=0;s<t;s++)e+=i[s];return e}getRowTop(t){let e=this.options.headerHeight;const i=this.stateManager.getRowHeights();for(let s=0;s<t;s++)e+=i[s];return e}}class bt{constructor(t,e,i,s){this.temporaryErrors=new Map,this.ctx=t,this.options=e,this.stateManager=i,this.dimensionCalculator=s}setTemporaryError(t,e){const{temporaryErrorTimeout:i}=this.options;if(!i)return;const s=`${t}:${e}`,n=Date.now()+i;this.temporaryErrors.set(s,{expireAt:n}),setTimeout(()=>{this.temporaryErrors.delete(s),this.draw()},i)}draw(){this.ctx.save(),this.ctx.font=this.options.font,this._clearCanvas(),this._cleanupExpiredErrors(),this.ctx.translate(-this.stateManager.getScrollLeft(),-this.stateManager.getScrollTop()),this._drawHeaders(),this._drawRowNumbers(),this._drawCells(),this._drawGridLines(),this._drawCopiedCellHighlight(),this._drawActiveCellHighlight(),this._drawSelectedColumnHighlight(),this._drawSelectedRowsHighlight(),this._drawDragRange(),this._drawCornerBox(),this.ctx.restore()}_cleanupExpiredErrors(){const t=Date.now();for(const[e,{expireAt:i}]of this.temporaryErrors.entries())t>=i&&this.temporaryErrors.delete(e)}_clearCanvas(){this.ctx.fillStyle="#ffffff",this.ctx.fillRect(0,0,this.stateManager.getViewportWidth(),this.stateManager.getViewportHeight()+this.options.headerHeight)}_drawCornerBox(){const{rowNumberWidth:t,headerHeight:e,gridLineColor:i,rowNumberBgColor:s}=this.options,n=0,l=0;this.ctx.save(),this.ctx.fillStyle=s,this.ctx.fillRect(n,l,t,e),this.ctx.strokeStyle=i,this.ctx.strokeRect(n-.5,l-.5,t,e),this.ctx.restore()}_drawHeaders(){const{headerHeight:t,rowNumberWidth:e,headerFont:i,headerBgColor:s,headerTextColor:n,gridLineColor:l,headerClipText:r,headerTextAlign:o,padding:a}=this.options,h=this.stateManager.getColumns(),c=this.stateManager.getSchema(),p=this.stateManager.getColumnWidths(),d=this.stateManager.getVisibleColStartIndex(),u=this.stateManager.getVisibleColEndIndex(),w=this.stateManager.getTotalContentWidth(),C=this.stateManager.getSelectedColumn();this.ctx.save();const f=e,m=0,S=w,b=t;this.ctx.beginPath(),this.ctx.rect(f,m,S-e,b),this.ctx.clip(),this.ctx.fillStyle=s,this.ctx.fillRect(e,0,w-e,t),this.ctx.font=i,this.ctx.textAlign=o,this.ctx.textBaseline="middle";let v=this.dimensionCalculator.getColumnLeft(d);for(let y=d;y<=u;y++){if(y<0||y>=h.length)continue;const E=h[y],_=c[E],B=(_==null?void 0:_.label)||E,$=p[y],F=C===y;let D=null;F?D=this.options.selectedHeaderBgColor:E.startsWith("custom:")&&(D=this.options.customHeaderBgColor),D&&(this.ctx.fillStyle=D,this.ctx.fillRect(v,0,$,t)),this.ctx.fillStyle=F?this.options.selectedHeaderTextColor:n;let H=v+a;o==="center"?H=v+$/2:o==="right"&&(H=v+$-a),r?(this.ctx.save(),this.ctx.beginPath(),this.ctx.rect(v,0,$,t),this.ctx.clip(),this.ctx.fillText(B,H,t/2),this.ctx.restore()):this.ctx.fillText(B,H,t/2,$-a*2),this.ctx.strokeStyle=l,this.ctx.beginPath();const A=Math.round(v+$)-.5;this.ctx.moveTo(A,0),this.ctx.lineTo(A,t),this.ctx.stroke(),v+=$}this.ctx.restore(),this.ctx.strokeStyle=l,this.ctx.beginPath();const R=t-.5;this.ctx.moveTo(e,R),this.ctx.lineTo(this.stateManager.getTotalContentWidth(),R),this.ctx.stroke()}_drawRowNumbers(){const{headerHeight:t,rowNumberWidth:e,font:i,rowNumberBgColor:s,selectedRowNumberBgColor:n,textColor:l,gridLineColor:r}=this.options,o=this.stateManager.getData(),a=this.stateManager.getTotalContentHeight();if(o.length){const c=this.stateManager.getRowHeights(),p=this.stateManager.getSelectedRows(),d=this.stateManager.getVisibleRowStartIndex(),u=this.stateManager.getVisibleRowEndIndex();this.ctx.save();const w=0,C=t,f=e,m=a;this.ctx.beginPath(),this.ctx.rect(w,C,f,m-t),this.ctx.clip(),this.ctx.fillStyle=s,this.ctx.fillRect(0,t,e,a-t),this.ctx.font=i,this.ctx.textAlign="center",this.ctx.textBaseline="middle";let S=this.dimensionCalculator.getRowTop(d);for(let b=d;b<=u;b++){if(b<0||b>=o.length)continue;const v=c[b];p.has(b)&&(this.ctx.fillStyle=n,this.ctx.fillRect(0,S,e,v)),this.ctx.fillStyle=l,this.ctx.fillText((b+1).toString(),e/2,S+v/2),this.ctx.strokeStyle=r,this.ctx.beginPath();const R=Math.round(S+v)-.5;this.ctx.moveTo(0,R),this.ctx.lineTo(e,R),this.ctx.stroke(),S+=v}this.ctx.restore()}this.ctx.strokeStyle=r,this.ctx.beginPath();const h=e-.5;this.ctx.moveTo(h,t),this.ctx.lineTo(h,Math.max(a,this.stateManager.getViewportHeight()+t)),this.ctx.stroke()}_drawCells(){var j,Q,tt,et,it;const{headerHeight:t,rowNumberWidth:e,font:i,textColor:s,textAlign:n,textBaseline:l,padding:r,cellBgColor:o,activeCellBgColor:a,selectedRowBgColor:h,selectedRangeBgColor:c,disabledCellBgColor:p,disabledCellTextColor:d,errorCellBgColor:u,errorTextColor:w,loadingTextColor:C,placeholderTextColor:f}=this.options,m=this.stateManager.getData(),S=this.stateManager.getColumns(),b=this.stateManager.getSchema(),v=this.stateManager.getRowHeights(),R=this.stateManager.getColumnWidths(),y=this.stateManager.getVisibleRowStartIndex(),E=this.stateManager.getVisibleRowEndIndex(),_=this.stateManager.getVisibleColStartIndex(),B=this.stateManager.getVisibleColEndIndex(),$=this.stateManager.getSelectedRows(),F=this.stateManager.getSelectedColumn(),D=this.stateManager.getActiveCell(),H=this.stateManager.getNormalizedSelectionRange(),A=this.stateManager.getScrollLeft(),q=this.stateManager.getScrollTop();this.ctx.save();const G=Math.max(0,e-A),Z=Math.max(0,t-q),lt=this.stateManager.getTotalContentWidth()-G,ht=this.stateManager.getTotalContentHeight()-Z;this.ctx.beginPath(),this.ctx.rect(G+A,Z+q,lt,ht),this.ctx.clip(),this.ctx.font=i,this.ctx.textAlign=n,this.ctx.textBaseline=l;let K=this.dimensionCalculator.getRowTop(y);for(let x=y;x<=E;x++){if(x<0||x>=m.length)continue;const U=v[x],ct=$.has(x);let L=this.dimensionCalculator.getColumnLeft(_);for(let T=_;T<=B;T++){if(T<0||T>=S.length)continue;const I=R[T],Y=S[T],V=b[Y],N=(j=m[x])==null?void 0:j[`error:${Y}`],st=this.stateManager.isCellDisabled(x,T),nt=(D==null?void 0:D.row)===x&&(D==null?void 0:D.col)===T,X=((Q=this.stateManager.getActiveEditor())==null?void 0:Q.row)===x&&((tt=this.stateManager.getActiveEditor())==null?void 0:tt.col)===T,dt=F===T,gt=(et=m[x])==null?void 0:et[`loading:${Y}`],rt=this.temporaryErrors.has(`${x}:${T}`),ut=H&&x>=H.start.row&&x<=H.end.row&&T>=H.start.col&&T<=H.end.col;let k=o;ct&&(k=h),dt&&(k=h),ut&&!nt&&(k=c),st&&(k=p),nt&&!X&&(k=a),(N||rt)&&(k=u),!X&&k&&(this.ctx.fillStyle=k,this.ctx.fillRect(L,K,I,U));let ot=!0;if(X&&!["select","boolean"].includes(V==null?void 0:V.type)&&(ot=!1),ot){const at=K+U/2;let P=L+r;if(gt)this.ctx.fillStyle=C,this.ctx.fillText("(Loading...)",P,at,I-r*2);else{const ft=(it=m[x])==null?void 0:it[Y];let z=Ct(ft,V==null?void 0:V.type,V==null?void 0:V.values);!z&&N&&(z=`${N}`.includes("required")?"(required)":N),z!=null&&z!==""&&(this.ctx.fillStyle=st?d:X?f:N||rt?w:s,n==="center"?P=L+I/2:n==="right"&&(P=L+I-r),this.ctx.fillText(z,P,at))}}L+=I}K+=U}this.ctx.restore()}_drawGridLines(){const{headerHeight:t,rowNumberWidth:e,gridLineColor:i}=this.options,s=this.stateManager.getTotalContentWidth(),n=this.stateManager.getTotalContentHeight(),l=this.stateManager.getColumns(),r=this.stateManager.getData(),o=this.stateManager.getColumnWidths(),a=this.stateManager.getRowHeights(),h=this.stateManager.getViewportWidth(),c=this.stateManager.getViewportHeight(),p=this.stateManager.getScrollLeft(),d=this.stateManager.getScrollTop();this.ctx.save(),this.ctx.strokeStyle=i,this.ctx.lineWidth=1;let u=e;for(let C=0;C<=l.length;C++){const f=Math.round(u)-.5;if(f>=e&&f<=h+p&&(this.ctx.beginPath(),this.ctx.moveTo(f,t),this.ctx.lineTo(f,n),this.ctx.stroke()),C<l.length&&(u+=o[C]),u>h+p)break}let w=t;for(let C=0;C<=r.length;C++){const f=Math.round(w)-.5;if(f>=t&&f<=c+d&&(this.ctx.beginPath(),this.ctx.moveTo(e,f),this.ctx.lineTo(s,f),this.ctx.stroke()),C<r.length&&(w+=a[C]),w>c+d)break}this.ctx.restore()}_drawActiveCellHighlight(){const t=this.stateManager.getActiveCell(),e=this.stateManager.isDraggingFillHandle(),i=this.stateManager.isResizing(),s=this.stateManager.getActiveEditor(),n=this.stateManager.getNormalizedSelectionRange();if(i||e||!t&&!n)return;const{highlightBorderColor:l,fillHandleColor:r,fillHandleSize:o}=this.options;this.ctx.save(),this.ctx.strokeStyle=l,this.ctx.lineWidth=2;let a=null,h=null;if(n){const c=this.getCellBounds(n.start.row,n.start.col),p=this.getCellBounds(n.end.row,n.end.col);c&&p&&(a={x:c.x,y:c.y,width:p.x+p.width-c.x,height:p.y+p.height-c.y}),t&&t.row!==null&&t.col!==null&&(h=this.getCellBounds(t.row,t.col))}else t&&t.row!==null&&t.col!==null&&(h=this.getCellBounds(t.row,t.col),a=h);if(a&&this.ctx.strokeRect(a.x+1,a.y+1,a.width-2,a.height-2),!s&&h){const c=o/2,p=h.x+h.width-c-1,d=h.y+h.height-c-1;this.ctx.fillStyle=r,this.ctx.beginPath(),this.ctx.arc(p,d,c,0,Math.PI*2),this.ctx.fill(),this.ctx.strokeStyle="#ffffff",this.ctx.lineWidth=1,this.ctx.stroke()}this.ctx.restore()}_drawDragRange(){const t=this.stateManager.isDraggingFillHandle(),e=this.stateManager.getDragStartCell(),i=this.stateManager.getDragEndRow();if(!t||!e||i===null||i===e.row)return;const{row:s,col:n}=e;if(s===null||n===null)return;const{dragRangeBorderColor:l}=this.options,r=i,o=this.stateManager.getColumnWidths(),a=this.stateManager.getRowHeights();if(n<0||n>=o.length)return;const h=o[n],c=this.dimensionCalculator.getColumnLeft(n),p=r>=s;let d,u;if(p){d=this.dimensionCalculator.getRowTop(s)+a[s],u=0;for(let m=s+1;m<=r&&!(m>=a.length);m++)u+=a[m]||this.options.defaultRowHeight}else{d=this.dimensionCalculator.getRowTop(r),u=0;for(let f=r;f<s&&!(f>=a.length);f++)u+=a[f]||this.options.defaultRowHeight}if(u<=0)return;const w=c,C=d;this.ctx.save(),this.ctx.strokeStyle=l,this.ctx.lineWidth=2,this.ctx.setLineDash([4,2]),this.ctx.strokeRect(w+.5,C+.5,h-1,u-1),this.ctx.restore()}_drawCopiedCellHighlight(){const t=this.stateManager.getCopiedCell(),e=this.stateManager.getCopiedSourceRange();if(!t&&!e)return;const{copyHighlightBorderColor:i,copyHighlightBorderDash:s}=this.options;let n=null;if(e){const l=this.getCellBounds(e.start.row,e.start.col),r=this.getCellBounds(e.end.row,e.end.col);l&&r&&(n={x:l.x,y:l.y,width:r.x+r.width-l.x,height:r.y+r.height-l.y})}else t&&t.row!==null&&t.col!==null&&(n=this.getCellBounds(t.row,t.col));n&&(this.ctx.save(),this.ctx.strokeStyle=i,this.ctx.lineWidth=1,this.ctx.setLineDash(s),this.ctx.strokeRect(n.x+.5,n.y+.5,n.width-1,n.height-1),this.ctx.restore())}_drawSelectedColumnHighlight(){const t=this.stateManager.getSelectedColumn();if(t===null)return;const{highlightBorderColor:e}=this.options,i=this.stateManager.getTotalContentHeight(),s=this.stateManager.getColumnWidths(),n=this.dimensionCalculator.getColumnLeft(t),l=s[t];l&&(this.ctx.save(),this.ctx.strokeStyle=e,this.ctx.lineWidth=2,this.ctx.strokeRect(n+1,1,l-2,i-2),this.ctx.restore())}_drawSelectedRowsHighlight(){const t=this.stateManager.getSelectedRows();if(t.size===0)return;const{highlightBorderColor:e}=this.options,i=this.stateManager.getTotalContentWidth(),s=this.stateManager.getRowHeights();this.ctx.save(),this.ctx.strokeStyle=e,this.ctx.lineWidth=2;for(const n of t){const l=s[n],r=this.dimensionCalculator.getRowTop(n);this.ctx.strokeRect(0,r,i,l)}this.ctx.restore()}getCellBounds(t,e){const i=this.stateManager.getData(),s=this.stateManager.getColumns(),n=this.stateManager.getColumnWidths(),l=this.stateManager.getRowHeights(),r=this.stateManager.getTotalContentWidth(),o=this.stateManager.getTotalContentHeight();if(t<0||t>=i.length||e<0||e>=s.length)return null;const a=n[e],h=l[t],c=this.dimensionCalculator.getColumnLeft(e),p=this.dimensionCalculator.getRowTop(t),d=c,u=p;return d<r&&d+a>0&&u<o&&u+h>0?{x:d,y:u,width:a,height:h}:null}getFillHandleBounds(t,e){const i=this.getCellBounds(t,e);if(!i)return null;const{fillHandleSize:s}=this.options,n=s/2,l=i.x+i.width-n-1,r=i.y+i.height-n-1;return{x:l-n,y:r-n,width:s,height:s}}}class vt{constructor(t,e,i,s,n,l,r,o){this.resizeTimeout=null,this._ignoreNextClick=!1,this.isCtrl=!1,this._customEventHandler=null,this.lastTouchX=null,this.lastTouchY=null,this.isTouching=!1,this.touchVelocityX=0,this.touchVelocityY=0,this.lastTouchTime=0,this.kineticScrollInterval=null,this.container=t,this.editingManager=e,this.interactionManager=i,this.stateManager=s,this.dimensionCalculator=n,this.renderer=l,this.options=r,this.domManager=o,this.canvas=this.domManager.getCanvas(),this.hScrollbar=this.domManager.getHScrollbar(),this.vScrollbar=this.domManager.getVScrollbar(),this.interactionManager.setEditingManager(this.editingManager)}bindEvents(t=null){this._customEventHandler=t,this.container.addEventListener("wheel",this._handleWheel.bind(this)),this.hScrollbar.addEventListener("scroll",this._handleHScroll.bind(this)),this.vScrollbar.addEventListener("scroll",this._handleVScroll.bind(this)),this.canvas.addEventListener("dblclick",this._handleDoubleClick.bind(this)),this.canvas.addEventListener("click",this._handleClick.bind(this)),this.canvas.addEventListener("mousedown",this._handleCanvasMouseDown.bind(this)),document.addEventListener("mousemove",this._handleDocumentMouseMove.bind(this)),document.addEventListener("mouseup",this._handleDocumentMouseUp.bind(this)),new ResizeObserver(()=>{this._handleResize()}).observe(this.container),document.addEventListener("mousedown",this._handleGlobalMouseDown.bind(this),!0),document.addEventListener("keydown",this._handleDocumentKeyDown.bind(this)),document.addEventListener("keyup",this._handleDocumentKeyUp.bind(this)),this.container.addEventListener("paste",this._handlePaste.bind(this)),this.canvas.addEventListener("touchstart",this._handleTouchStart.bind(this)),this.canvas.addEventListener("touchmove",this._handleTouchMove.bind(this)),this.canvas.addEventListener("touchend",this._handleTouchEnd.bind(this)),this.canvas.addEventListener("touchcancel",this._handleTouchEnd.bind(this)),this.editingManager.bindInternalEvents()}_handleScroll(){this.interactionManager.onScroll()}_handleWheel(t){const e=t.deltaY,i=t.shiftKey;this.interactionManager.canScrollMore(e,!i)&&(t.preventDefault(),this.interactionManager.moveScroll(i?e:0,i?0:e),this._handleScroll())}_handleHScroll(t){const i=t.target.scrollLeft;this.stateManager.updateScroll(this.stateManager.getScrollTop(),i),this._handleScroll()}_handleVScroll(t){const i=t.target.scrollTop;this.stateManager.updateScroll(i,this.stateManager.getScrollLeft()),this._handleScroll()}_handleResize(){this.resizeTimeout&&clearTimeout(this.resizeTimeout),this.resizeTimeout=window.setTimeout(()=>{this.editingManager.deactivateEditor(!1),this.editingManager.hideDropdown(),this.dimensionCalculator.calculateDimensions(this.container.clientWidth,this.container.clientHeight),this.domManager.updateCanvasSize(this.stateManager.getTotalContentWidth(),this.stateManager.getTotalContentHeight()),this.renderer.draw(),this.resizeTimeout=null},100)}_handleDoubleClick(t){if(this.stateManager.isResizing()){g("log",this.options.verbose,"Double click ignored due to active resize.");return}const e=this._getCoordsFromEvent(t);if(!e||e.row===null||e.col===null)return;let i=!1;if(i=i||this.interactionManager.clearSelections(),i=i||this.interactionManager.clearCopiedCell(),i=i||this.stateManager.setActiveCell(e),this.stateManager.isCellDisabled(e.row,e.col)){g("log",this.options.verbose,`Edit prevented: Cell ${e.row},${e.col} is disabled.`),i&&this.renderer.draw();return}this.editingManager.activateEditor(e.row,e.col)}_handleClick(t){if(this._ignoreNextClick){this._ignoreNextClick=!1;return}if(this.stateManager.isDraggingFillHandle()||this.stateManager.isResizing()){g("log",this.options.verbose,"Click ignored due to active fill handle drag or resize.");return}const e=this._getCoordsFromEvent(t),i=e&&e.row!==null&&e.col!==null,s=e&&e.row!==null&&e.col===null&&this._isRowNumberAreaClick(t),n=this._isHeaderAreaClick(t);let l=!1;if(this.editingManager.isEditorActive()){const o=this.stateManager.getActiveEditor();i&&(e==null?void 0:e.row)===(o==null?void 0:o.row)&&(e==null?void 0:e.col)===(o==null?void 0:o.col)||this.editingManager.deactivateEditor(!0)}else this.editingManager.isDropdownVisible()&&this.editingManager.hideDropdown();const r=this.stateManager.isCopyActive();if(s&&e&&e.row!==null){const o=this.interactionManager.handleRowNumberClick(e.row,t.shiftKey,t.ctrlKey||t.metaKey),a=r?this.interactionManager.clearCopiedCell():!1;l=o||a}else if(n){const o=this._getColumnFromEvent(t);if(o!==null){const a=this.interactionManager.handleHeaderClick(o),h=r?this.interactionManager.clearCopiedCell():!1;l=a||h}}else{const o=this.stateManager.setActiveCell(null);let a=!1,h=!1;o&&(a=this.interactionManager.clearSelections(),h=this.stateManager.clearSelectionRange());const c=r?this.interactionManager.clearCopiedCell():!1;l=o||a||h||c}l&&this.renderer.draw()}_handleCanvasMouseDown(t){if(this._ignoreNextClick=!1,this.interactionManager.checkResizeHandles(t)){t.preventDefault(),t.stopPropagation();return}const i=this.stateManager.getActiveCell();let s=!1;if(i&&i.row!==null&&i.col!==null&&(s=!0,this.interactionManager.checkFillHandle(t))){t.preventDefault(),t.stopPropagation();return}const n=this._getCoordsFromEvent(t);if(n&&n.row!==null&&n.col!==null){if(this.editingManager.isEditorActive()){const r=this.stateManager.getActiveEditor();(n.row!==(r==null?void 0:r.row)||n.col!==(r==null?void 0:r.col))&&this.editingManager.deactivateEditor(!0)}if(t.shiftKey&&s&&n.row!==(i==null?void 0:i.row)&&n.col!==(i==null?void 0:i.col)){g("log",this.options.verbose,`shift click detected at ${i==null?void 0:i.row},${i==null?void 0:i.col} -> ${n.row},${n.col}`),t.preventDefault(),this.domManager.focusContainer();return}this.interactionManager.startSelectionDrag(n)&&this.renderer.draw(),t.preventDefault(),this.domManager.focusContainer()}}_handleDocumentMouseMove(t){if(this.stateManager.isResizing())this.interactionManager.handleResizeMouseMove(t);else if(this.stateManager.isDraggingFillHandle())this.interactionManager.handleFillHandleMouseMove(t),this._ignoreNextClick=!0;else if(this.stateManager.getIsDraggingSelection()){const e=this._getCoordsFromEvent(t);e&&this.interactionManager.updateSelectionDrag(e)&&this.renderer.draw()}else this.interactionManager.updateCursorStyle(t)}_handleDocumentMouseUp(t){let e=!1;const i=this.stateManager.getActiveCell();if(this.stateManager.getIsDraggingSelection())e=!0,this.interactionManager.endSelectionDrag();else if(t.shiftKey&&i&&i.row!==null&&i.col!==null){const s=this._getCoordsFromEvent(t);s&&s.row!==null&&s.col!==null&&(this.interactionManager.startSelectionDrag(i),this.interactionManager.updateSelectionDrag(s),this.interactionManager.endSelectionDrag(),this.renderer.draw(),e=!0,g("log",this.options.verbose,`shift click received: ${i.row},${i.col} -> ${s.row},${s.col}`))}this.stateManager.isResizing()&&(this.interactionManager.endResize(),e=!0),this.stateManager.isDraggingFillHandle()&&this.interactionManager.endFillHandleDrag(),this.interactionManager.updateCursorStyle(t),e&&(this._ignoreNextClick=!0)}_handleGlobalMouseDown(t){if(!(this.stateManager.isDraggingFillHandle()||this.stateManager.isResizing()||this.stateManager.getIsDraggingSelection())&&!this.container.contains(t.target)&&document.activeElement===this.container){g("log",this.options.verbose,"Outside click on container");let e=!1;if(this.editingManager.isEditorActive()||this.editingManager.isDropdownVisible())this.editingManager.deactivateEditor(!0);else{const i=this.stateManager.setActiveCell(null);let s=!1,n=!1;i&&(s=this.interactionManager.clearSelections(),n=this.stateManager.clearSelectionRange());const l=this.interactionManager.clearCopiedCell();e=i||s||n||l}e&&this.renderer.draw()}}_handleDocumentKeyDown(t){(t.ctrlKey||t.metaKey)&&(this.isCtrl=!0)}_handleDocumentKeyUp(t){var o,a;const e=this.isCtrl;(t.ctrlKey||t.metaKey)&&(this.isCtrl=!1);let i=!1,s=!1;if(this.editingManager.isEditorActive()||this.editingManager.isDropdownVisible())return;if(e&&t.key==="c"){i=this.interactionManager.copy(),t.preventDefault(),i&&this.renderer.draw();return}if(e&&t.key==="v"){i=this.interactionManager.paste(),t.preventDefault(),i&&this.renderer.draw();return}const n=this.stateManager.getActiveCell(),l=n&&n.row!==null&&n.col!==null,r=l&&this.stateManager.isCellDisabled(n.row,n.col);if(t.key==="Delete"||t.key==="Backspace"){const h=this.stateManager.getSelectedColumn();if(this.stateManager.getSelectedRows().size>0)i=this.interactionManager.deleteSelectedRows(),t.preventDefault();else if(l){const{row:c,col:p}=n,d=this.stateManager.getColumnKey(p);if(!r){const u=this.stateManager.getCellData(c,p);try{i=this.stateManager.updateCell(c,d,null,!0)}catch(w){g("warn",this.options.verbose,w),w instanceof J&&(i=!0,w.errorType==="required"&&!u?this.stateManager.updateCell(c,`error:${d}`,w.message):this.renderer.setTemporaryError(c,p))}}t.preventDefault()}else t.key==="Delete"&&h!==null&&((o=this.stateManager.getColumnKey(h))!=null&&o.startsWith("custom:"))&&(this.stateManager.removeColumn(h),i=!0,s=!0,t.preventDefault())}else if(t.key.startsWith("Arrow")){if(n){let h=0,c=0;t.key==="ArrowUp"?h=-1:t.key==="ArrowDown"?h=1:t.key==="ArrowLeft"?c=-1:t.key==="ArrowRight"&&(c=1),(h!==0||c!==0)&&(i=this.interactionManager.moveActiveCell(h,c,!1),i&&(this.interactionManager.clearSelections(),this.stateManager.clearSelectionRange()),t.preventDefault())}}else if(t.key==="Enter"&&n)!r&&n.row!==null&&n.col!==null&&(this.editingManager.activateEditor(n.row,n.col),t.preventDefault());else if(t.key==="Tab"&&n){if(document.activeElement!==this.container&&!this.container.contains(document.activeElement)){document.activeElement===document.body&&this.domManager.focusContainer();return}i=this.interactionManager.moveActiveCell(0,t.shiftKey?-1:1),i&&(this.interactionManager.clearSelections(),this.stateManager.clearSelectionRange()),t.preventDefault()}else!e&&!t.ctrlKey&&t.key.length===1&&n&&n.row!==null&&n.col!==null&&!r&&this.editingManager.activateEditor(n.row,n.col,t.key);s?(a=this._customEventHandler)==null||a.call(this,new CustomEvent("resize")):i&&this.renderer.draw()}_handlePaste(t){if(this.editingManager.isEditorActive()||!t.clipboardData)return;const e=t.clipboardData.getData("text/plain");if(!e)return;if(this.interactionManager.paste()){t.preventDefault(),this.renderer.draw();return}const i=this.stateManager.getActiveCell(),s=this.stateManager.getNormalizedSelectionRange(),n=this.stateManager.getSelectedColumn();if(n!==null){const c=e.split(/\r\n|\n|\r/)[0].split("	")[0];c&&(g("log",this.options.verbose,"Handling column paste from clipboard"),t.preventDefault(),this.interactionManager.pasteToColumnExternal(n,c)&&this.renderer.draw());return}const l=s,r=!l&&i?i:null;if(!l&&!r){g("log",this.options.verbose,"Clipboard paste ignored: No target cell or range selected.");return}g("log",this.options.verbose,"Handling native paste event."),t.preventDefault();let o=!1;const a=e.split(/\r\n|\n|\r/).map(c=>c.split("	")),h=a.length===1&&a[0].length===1;l?o=this.interactionManager.pasteRangeToRangeExternal(l,a):r&&r.row!==null&&r.col!==null&&(h?o=this.interactionManager.pasteSingleValueExternal(r,a[0][0]):o=this.interactionManager.pasteRangeFromTopLeftExternal(r,a)),o&&this.renderer.draw()}_getCoordsFromEvent(t){const e=this.domManager.getCanvasBoundingClientRect(),i=t.clientX-e.left,s=t.clientY-e.top,n=i+this.stateManager.getScrollLeft(),l=s+this.stateManager.getScrollTop(),{headerHeight:r,rowNumberWidth:o}=this.options,a=this.stateManager.getData().length,h=this.stateManager.getColumns(),c=this.stateManager.getRowHeights(),p=this.stateManager.getColumnWidths();let d=null,u=null;if(l>=r){let w=r;for(let C=0;C<a;C++){const f=c[C]||this.options.defaultRowHeight;if(l>=w&&l<w+f){d=C;break}if(w+=f,w>l)break}}if(d!==null)if(n>=o){let w=o;for(let C=0;C<h.length;C++){const f=p[C]||this.options.defaultColumnWidth;if(n>=w&&n<w+f){u=C;break}if(w+=f,w>n)break}}else u=null;else d=null,u=null;return d===null&&u===null&&n>o&&l<r||d===null&&u===null&&n<o&&l<r?null:d!==null?{row:d,col:u}:null}_getColumnFromEvent(t){const e=this.domManager.getCanvasBoundingClientRect(),i=t.clientX-e.left+this.stateManager.getScrollLeft(),{rowNumberWidth:s}=this.options,n=this.stateManager.getColumns(),l=this.stateManager.getColumnWidths();if(i<s)return null;let r=s;for(let o=0;o<n.length;o++){const a=l[o]||this.options.defaultColumnWidth;if(i>=r&&i<r+a)return o;r+=a}return null}_isRowNumberAreaClick(t){const e=this.domManager.getCanvasBoundingClientRect();return t.clientX-e.left<this.options.rowNumberWidth}_isHeaderAreaClick(t){const e=this.domManager.getCanvasBoundingClientRect();return t.clientY-e.top<this.options.headerHeight}_handleTouchStart(t){if(t.preventDefault(),t.touches.length===1){const e=t.touches[0];this.lastTouchX=e.clientX,this.lastTouchY=e.clientY,this.isTouching=!0,this.lastTouchTime=Date.now(),this.kineticScrollInterval!==null&&(window.clearInterval(this.kineticScrollInterval),this.kineticScrollInterval=null),this.editingManager.deactivateEditor(!1),this.editingManager.hideDropdown()}}_handleTouchMove(t){if(!(!this.isTouching||!this.lastTouchX||!this.lastTouchY)&&(t.preventDefault(),t.touches.length===1)){const e=t.touches[0],i=e.clientX,s=e.clientY,n=this.lastTouchX-i,l=this.lastTouchY-s,r=Date.now(),o=r-this.lastTouchTime;o>0&&(this.touchVelocityX=n/o*15,this.touchVelocityY=l/o*15),this.interactionManager.moveScroll(n,l),this._handleScroll(),this.lastTouchX=i,this.lastTouchY=s,this.lastTouchTime=r}}_handleTouchEnd(t){t.preventDefault(),this.isTouching=!1,(Math.abs(this.touchVelocityX)>.5||Math.abs(this.touchVelocityY)>.5)&&this._startKineticScroll()}_startKineticScroll(){this.kineticScrollInterval!==null&&window.clearInterval(this.kineticScrollInterval),this.kineticScrollInterval=window.setInterval(()=>{if(this.touchVelocityX*=.95,this.touchVelocityY*=.95,Math.abs(this.touchVelocityX)<.5&&Math.abs(this.touchVelocityY)<.5){window.clearInterval(this.kineticScrollInterval),this.kineticScrollInterval=null;return}this.interactionManager.moveScroll(this.touchVelocityX,this.touchVelocityY),this._handleScroll()},16)}}class yt{constructor(t,e,i,s,n,l){this.dropdownItems=[],this.highlightedDropdownIndex=-1,this.container=t,this.options=e,this.stateManager=i,this.domManager=s,this.renderer=n,this.interactionManager=l,this.editorInput=this.domManager.getEditorInput();const r=this.domManager.getDropdownElements();this.dropdown=r.dropdown,this.dropdownSearchInput=r.searchInput,this.dropdownList=r.list}bindInternalEvents(){this.editorInput.addEventListener("blur",this._handleEditorBlur.bind(this)),this.editorInput.addEventListener("keydown",this._handleEditorKeyDown.bind(this)),this.dropdown.addEventListener("mousedown",t=>t.stopPropagation()),this.dropdownSearchInput.addEventListener("input",this._handleDropdownSearch.bind(this)),this.dropdownSearchInput.addEventListener("keydown",this._handleDropdownKeyDown.bind(this)),this.dropdownList.addEventListener("click",this._handleDropdownItemClick.bind(this))}isEditorActive(){return!!this.stateManager.getActiveEditor()}isDropdownVisible(){return this.dropdown.style.display!=="none"}activateEditor(t,e,i){const{customDatePicker:s,verbose:n,font:l,onEditorOpen:r}=this.options,o=this.stateManager.getColumnKey(e),a=this.stateManager.getRowData(t);if(!a){g("warn",n,`Cannot activate editor: Cell ${t},${e} row data not found.`);return}if(a!=null&&a[`loading:${o}`]){g("log",n,`Edit prevented: Cell ${t},${e} is loading.`);return}if(this.stateManager.isCellDisabled(t,e)){g("log",n,`Edit prevented: Cell ${t},${e} is disabled.`);return}this.isEditorActive()&&this.deactivateEditor(!0),this.hideDropdown();const h=this.renderer.getCellBounds(t,e);if(!h){g("warn",n,`Cannot activate editor: Cell ${t},${e} bounds not found (likely not visible).`);return}const{scrollLeft:c,scrollTop:p}=this.interactionManager.bringBoundsIntoView(h),d=this.stateManager.getSchemaForColumn(e),u=a==null?void 0:a[o];this.stateManager.setActiveEditor({row:t,col:e,type:d==null?void 0:d.type,originalValue:u});const{x:w,y:C,width:f,height:m}=h,S=w-c,b=C-p;if((d==null?void 0:d.type)==="date"&&s&&r)try{r(t,o,a,{x:S,y:b,width:f,height:m})}catch(v){g("error",n,`Error calling onEditorOpen: ${v}`)}else(d==null?void 0:d.type)==="select"||(d==null?void 0:d.type)==="boolean"?this._showDropdown(t,e,d,S,b,f,m):(this.editorInput.style.display="block",this.editorInput.style.left=`${S}px`,this.editorInput.style.top=`${b}px`,this.editorInput.style.width=`${f}px`,this.editorInput.style.height=`${m}px`,this.editorInput.style.font=l,(d==null?void 0:d.type)==="number"?(this.editorInput.type="number",this.editorInput.step=d.decimal===!1?"1":"any"):(d==null?void 0:d.type)==="email"?this.editorInput.type="email":(d==null?void 0:d.type)==="date"?this.editorInput.type="date":this.editorInput.type="text",this.editorInput.value=mt(u,d==null?void 0:d.type),this.editorInput.focus(),i&&(["text","email"].includes(d==null?void 0:d.type)||(d==null?void 0:d.type)==="number"&&i.match(/^\d*\.?\d*$/))?this.editorInput.value=i:this.editorInput.select());this.renderer.draw()}deactivateEditor(t=!0,e=!1){const i=this.stateManager.getActiveEditor();if(!i)return;const{row:s,col:n,type:l,originalValue:r}=i;let o=!1,a=!1;if(l==="select"||l==="boolean")this.isDropdownVisible()&&(this.hideDropdown(),a=!0),o=this.stateManager.getCellData(s,n)!==r;else if(this.editorInput.style.display!=="none"){if(t){const h=this.editorInput.value,c=this.stateManager.getSchemaForColumn(n),p=this.stateManager.getColumnKey(n),d=Mt(h,c==null?void 0:c.type),u=W(d,c,p,this.options.verbose);"error"in u?(g("log",this.options.verbose,u.error),u.errorType==="required"?this.stateManager.updateCell(s,`error:${p}`,u.error):this.renderer.setTemporaryError(s,n),a=!0):(this.stateManager.removeCellValue(s,`error:${p}`),d!==r&&(this.stateManager.updateCellInternal(s,n,d),o=!0,this.interactionManager._batchUpdateCellsAndNotify([s],[p])))}this.editorInput.style.display="none",this.editorInput.value="",a=!0}this.stateManager.setActiveEditor(null),e&&(this.stateManager.setActiveCell({row:s,col:n}),a=!0),(o||a)&&this.renderer.draw()}hasEditorSelection(){return this.highlightedDropdownIndex>=0}_handleEditorBlur(t){setTimeout(()=>{const e=t.relatedTarget;document.activeElement!==this.editorInput&&!this.dropdown.contains(e)&&this.deactivateEditor(!0)},0)}_handleEditorKeyDown(t){let e=!1;switch(t.key){case"Enter":this.deactivateEditor(!0),e=this.interactionManager.moveActiveCell(1,0),e&&(this.interactionManager.clearSelections(),this.stateManager.clearSelectionRange()),t.preventDefault();break;case"Escape":this.deactivateEditor(!1,!0),this.domManager.focusContainer(),t.preventDefault();return;case"Tab":this.deactivateEditor(!0),e=this.interactionManager.moveActiveCell(0,t.shiftKey?-1:1),e&&(this.interactionManager.clearSelections(),this.stateManager.clearSelectionRange()),t.preventDefault();break}e&&this.renderer.draw()}_showDropdown(t,e,i,s,n,l,r){if(this.dropdownItems=[],this.dropdownList.innerHTML="",(i==null?void 0:i.type)==="boolean")this.dropdownItems=[{id:!0,name:"True"},{id:!1,name:"False"},{id:null,name:"(Blank)"}];else if((i==null?void 0:i.type)==="select"&&i.values)this.dropdownItems=[{id:null,name:"(Blank)"},...i.values];else{g("warn",this.options.verbose,`Dropdown requested for non-dropdown type: ${i==null?void 0:i.type}`);return}this.dropdownItems.forEach((o,a)=>{const h=document.createElement("li");h.className="spreadsheet-dropdown-item",h.textContent=o.name,h.dataset.index=String(a),h.dataset.value=String(o.id===null||o.id===void 0?"":o.id),h.style.padding="5px 10px",h.style.cursor="pointer",h.addEventListener("mouseenter",()=>h.style.backgroundColor="#f0f0f0"),h.addEventListener("mouseleave",()=>h.style.backgroundColor="white"),this.dropdownList.appendChild(h)}),this.dropdown.style.display="block",this.dropdown.style.left=`${s}px`,this.dropdown.style.top=`${n+r}px`,this.dropdown.style.minWidth=`${l}px`,this.dropdown.style.maxHeight="200px",requestAnimationFrame(()=>{var c;const o=this.dropdown.getBoundingClientRect(),a=this.container.getBoundingClientRect();if(o.bottom>a.bottom&&n>=o.height&&(this.dropdown.style.top=`${n-o.height}px`),o.right>a.right){const p=a.right-o.width-5;this.dropdown.style.left=`${Math.max(0,p)}px`}o.left<a.left&&(this.dropdown.style.left=`${a.left}px`),parseFloat(this.dropdown.style.top)<a.top&&(this.dropdown.style.top=`${a.top}px`);const h=(((c=this.dropdown.firstChild)==null?void 0:c.clientHeight)||0)+15;this.dropdown.style.maxHeight=`${200+h}px`}),this.dropdownSearchInput.value="",this._filterDropdown(""),this.dropdownSearchInput.focus(),this.highlightedDropdownIndex=-1,this._updateDropdownHighlight(Array.from(this.dropdownList.querySelectorAll("li:not(.hidden)")))}hideDropdown(){this.dropdown.style.display!=="none"&&(this.dropdown.style.display="none",this.highlightedDropdownIndex=-1)}_handleDropdownSearch(){const t=this.dropdownSearchInput.value.toLowerCase();this._filterDropdown(t);const e=Array.from(this.dropdownList.querySelectorAll("li:not(.hidden)"));this.highlightedDropdownIndex=e.length>0?0:-1,this._updateDropdownHighlight(e)}_filterDropdown(t){this.dropdownList.querySelectorAll("li").forEach(i=>{var l;const n=(((l=i.textContent)==null?void 0:l.toLowerCase())||"").includes(t);i.classList.toggle("hidden",!n),i.style.display=n?"block":"none"})}_handleDropdownKeyDown(t){const e=Array.from(this.dropdownList.querySelectorAll("li:not(.hidden)"));if(!e.length&&t.key!=="Escape")return;let i=this.highlightedDropdownIndex;switch(t.key){case"ArrowDown":t.preventDefault(),i=(i+1)%e.length;break;case"ArrowUp":t.preventDefault(),i=(i-1+e.length)%e.length;break;case"Enter":t.preventDefault();let s=-1;i>=0&&i<e.length?s=i:e.length===1&&(s=0),s>=0&&e[s].click();return;case"Escape":t.preventDefault(),this.deactivateEditor(!1,!0),this.domManager.focusContainer();return;case"Tab":if(t.preventDefault(),!`${this.dropdownSearchInput.value}`.trim()&&i<0){this.deactivateEditor(!1);return}break;default:return}this.highlightedDropdownIndex=i,this._updateDropdownHighlight(e)}_updateDropdownHighlight(t){t.forEach((e,i)=>{const s=i===this.highlightedDropdownIndex;e.classList.toggle("highlighted",s),e.style.backgroundColor=s?"#dbeafe":"white",s&&e.scrollIntoView({block:"nearest"})})}_handleDropdownItemClick(t){const e=t.target;if(e.tagName==="LI"&&e.classList.contains("spreadsheet-dropdown-item")){const i=this.stateManager.getActiveEditor();if(!i)return;const s=parseInt(e.dataset.index||"-1",10);if(s<0||s>=this.dropdownItems.length)return;const n=this.dropdownItems[s],{row:l,col:r}=i;let o=n.id;typeof o=="string"&&i.type==="boolean"&&(o.toLowerCase()==="true"?o=!0:o.toLowerCase()==="false"&&(o=!1)),this.stateManager.updateCellInternal(l,r,o),this.interactionManager._batchUpdateCellsAndNotify([l],[this.stateManager.getColumnKey(r)]),setTimeout(()=>{this.deactivateEditor(!1),this.domManager.focusContainer()},200)}}}class Rt{constructor(t,e,i,s,n){this.lastPasteHandledAt=null,this.ignoreNextScrollTimeout=null,this.options=t,this.stateManager=e,this.renderer=i,this.dimensionCalculator=s,this.domManager=n}setEditingManager(t){this.editingManager=t}canScrollMore(t,e){return e?t>0?this.domManager.canVScrollDown():this.domManager.canVScrollUp():t>0?this.domManager.canHScrollRight():this.domManager.canHScrollLeft()}moveScroll(t,e,i=!1){const s=this.domManager.setVScrollPosition(i?e:this.domManager.getVScrollPosition()+e),n=this.domManager.setHScrollPosition(i?t:this.domManager.getHScrollPosition()+t);this.stateManager.updateScroll(s,n)}bringBoundsIntoView(t){const e=this.domManager.getHScrollPosition(),i=this.domManager.getVScrollPosition(),s=this.domManager.getCanvasBoundingClientRect(),n=t.x-e,l=t.y-i,r=t.width,o=t.height;let a=e,h=i;return n<0?a+=n:n+r>s.width&&(a+=n+r-s.width),l<0?h+=l:l+o>s.height&&(h+=l+o-s.height),(a!==e||h!==i)&&this.moveScroll(a,h,!0),this.ignoreNextScrollTimeout=null,this.onScroll(!1),this.ignoreNextScrollTimeout=setTimeout(()=>{this.ignoreNextScrollTimeout=null},10),{scrollLeft:a,scrollTop:h}}onScroll(t=!0){if(this.ignoreNextScrollTimeout){clearTimeout(this.ignoreNextScrollTimeout),this.ignoreNextScrollTimeout=null;return}t&&(this.editingManager.deactivateEditor(!1),this.editingManager.hideDropdown()),this.dimensionCalculator.calculateVisibleRange(),this.renderer.draw()}handleRowNumberClick(t,e,i){g("log",this.options.verbose,`Row ${t} clicked. Shift: ${e}, Ctrl: ${i}`);const s=new Set(this.stateManager.getSelectedRows());let n=this.stateManager.getLastClickedRow();const l=JSON.stringify(Array.from(s).sort()),r=n;if(e&&n!==null){const c=Math.min(n,t),p=Math.max(n,t),d=new Set;for(let u=c;u<=p;u++)d.add(u);JSON.stringify(Array.from(d).sort())!==l&&this.stateManager.setSelectedRows(d,n),g("log",this.options.verbose,"Selected rows (Shift):",Array.from(d).sort((u,w)=>u-w))}else i?(s.has(t)?s.delete(t):s.add(t),n=t,this.stateManager.setSelectedRows(s,n),g("log",this.options.verbose,"Selected rows (Ctrl):",Array.from(s).sort((c,p)=>c-p))):(s.clear(),s.add(t),n=t,this.stateManager.setSelectedRows(s,n),g("log",this.options.verbose,"Selected rows (Single):",Array.from(s).sort((c,p)=>c-p)));const o=JSON.stringify(Array.from(this.stateManager.getSelectedRows()).sort())!==l,a=this.stateManager.getLastClickedRow()!==r,h=o||a;return h&&(this.stateManager.setActiveCell(null),this.stateManager.clearSelectionRange(),this.stateManager.setSelectedColumn(null)),h}handleHeaderClick(t){g("log",this.options.verbose,`Column ${t} clicked.`);const e=this.stateManager.getSelectedColumn();this.stateManager.setSelectedColumn(t);const i=e!==t;return i&&(this.stateManager.setActiveCell(null),this.stateManager.clearSelectionRange(),this.stateManager.setSelectedRows(new Set,null)),i}clearSelections(){let t=!1;return this.stateManager.getSelectedRows().size>0&&(t=this.stateManager.setSelectedRows(new Set,null)||t),this.stateManager.getSelectedColumn()!==null&&(t=this.stateManager.setSelectedColumn(null)||t),t}checkResizeHandles(t){const e=this.domManager.getCanvasBoundingClientRect(),i=t.clientX-e.left,s=t.clientY-e.top,n=i+this.stateManager.getScrollLeft(),l=s+this.stateManager.getScrollTop(),{headerHeight:r,rowNumberWidth:o,resizeHandleSize:a}=this.options,h=this.stateManager.getColumns(),c=this.stateManager.getData(),p=this.stateManager.getColumnWidths(),d=this.stateManager.getRowHeights();if(l<r&&n>o){let u=o;for(let w=0;w<h.length;w++){const C=p[w],f=u+C;if(Math.abs(n-f)<=a)return this._startColumnResize(w,t.clientX),"column";u=f}}if(n<o&&l>r){let u=r;for(let w=0;w<c.length;w++){const C=d[w],f=u+C;if(Math.abs(l-f)<=a)return this._startRowResize(w,t.clientY),"row";u=f}}return null}_startColumnResize(t,e){g("log",this.options.verbose,`Starting column resize for index ${t}`),this.stateManager.setResizeColumnState({isResizing:!0,columnIndex:t,startX:e}),this.domManager.setCursor("col-resize")}_startRowResize(t,e){g("log",this.options.verbose,`Starting row resize for index ${t}`),this.stateManager.setResizeRowState({isResizing:!0,rowIndex:t,startY:e}),this.domManager.setCursor("row-resize")}handleResizeMouseMove(t){const e=this.stateManager.getResizeColumnState(),i=this.stateManager.getResizeRowState();if(e.isResizing&&e.columnIndex!==null&&e.startX!==null){const{minColumnWidth:s,maxColumnWidth:n}=this.options,l=t.clientX-e.startX,r=this.stateManager.getColumnWidths(),o=e.columnIndex,a=r[o];let h=a+l;if(h=Math.max(s,Math.min(h,n)),h!==a){const c=[...r];c[o]=h,this.stateManager.setColumnWidths(c),this.stateManager.setResizeColumnState({...e,startX:t.clientX}),this.dimensionCalculator.calculateTotalSize(),this.dimensionCalculator.calculateVisibleRange(),this.domManager.updateCanvasSize(this.stateManager.getTotalContentWidth(),this.stateManager.getTotalContentHeight()),this.renderer.draw()}}else if(i.isResizing&&i.rowIndex!==null&&i.startY!==null){const{minRowHeight:s,maxRowHeight:n}=this.options,l=t.clientY-i.startY,r=this.stateManager.getRowHeights(),o=i.rowIndex,a=r[o];let h=a+l;if(h=Math.max(s,Math.min(h,n)),h!==a){const c=[...r];c[o]=h,this.stateManager.setRowHeights(c),this.stateManager.setResizeRowState({...i,startY:t.clientY}),this.dimensionCalculator.calculateTotalSize(),this.dimensionCalculator.calculateVisibleRange(),this.domManager.updateCanvasSize(this.stateManager.getTotalContentWidth(),this.stateManager.getTotalContentHeight()),this.renderer.draw()}}}endResize(){const t=this.stateManager.getResizeColumnState(),e=this.stateManager.getResizeRowState();t.isResizing&&(g("log",this.options.verbose,`Finished column resize for index ${t.columnIndex}. New width: ${this.stateManager.getColumnWidths()[t.columnIndex]}`),this.stateManager.setResizeColumnState({isResizing:!1,columnIndex:null,startX:null})),e.isResizing&&(g("log",this.options.verbose,`Finished row resize for index ${e.rowIndex}. New height: ${this.stateManager.getRowHeights()[e.rowIndex]}`),this.stateManager.setResizeRowState({isResizing:!1,rowIndex:null,startY:null}))}updateCursorStyle(t){if(this.stateManager.isResizing()||this.stateManager.isDraggingFillHandle())return;const e=this.stateManager.getScrollTop(),i=this.stateManager.getScrollLeft(),s=this.domManager.getCanvasBoundingClientRect(),n=t.clientX-s.left,l=t.clientY-s.top,r=n+i,o=l+e,{headerHeight:a,rowNumberWidth:h,resizeHandleSize:c}=this.options,p=this.stateManager.getColumns(),d=this.stateManager.getData(),u=this.stateManager.getColumnWidths(),w=this.stateManager.getRowHeights();let C="default";if(o<a&&r>h&&e<a){let m=h;for(let S=0;S<p.length;S++){const b=m+u[S];if(Math.abs(r-b)<=c){C="col-resize";break}if(m=b,m>r+c)break}}if(C==="default"&&r<h&&o>a&&i<h){let m=a;for(let S=0;S<d.length;S++){const b=m+w[S];if(Math.abs(o-b)<=c){C="row-resize";break}if(m=b,m>o+c)break}}const f=this.stateManager.getActiveCell();if(C==="default"&&f&&f.row!==null&&f.col!==null&&!this.stateManager.getActiveEditor()){const m=this.renderer.getFillHandleBounds(f.row,f.col);m&&r>=m.x&&r<=m.x+m.width&&o>=m.y&&o<=m.y+m.height&&(C="crosshair")}this.domManager.setCursor(C)}checkFillHandle(t){const e=this.stateManager.getActiveCell();if(!e||this.stateManager.getActiveEditor()||this.stateManager.isResizing()||e.row===null||e.col===null)return!1;const i=this.renderer.getFillHandleBounds(e.row,e.col);if(!i)return!1;const s=this.domManager.getCanvasBoundingClientRect(),n=t.clientX-s.left+this.stateManager.getScrollLeft(),l=t.clientY-s.top+this.stateManager.getScrollTop();return n>=i.x&&n<=i.x+i.width&&l>=i.y&&l<=i.y+i.height?(this._startFillHandleDrag(e),!0):!1}_startFillHandleDrag(t){t.row===null||t.col===null||(this.stateManager.setDragState({isDragging:!0,startCell:{...t},endRow:t.row}),this.domManager.setCursor("crosshair"),g("log",this.options.verbose,"Started dragging fill handle from",t))}handleFillHandleMouseMove(t){if(!this.stateManager.isDraggingFillHandle())return;const e=this.stateManager.getDragStartCell();if(!e||e.row===null)return;const i=this.domManager.getCanvasBoundingClientRect(),s=t.clientY-i.top+this.stateManager.getScrollTop(),n=this.options.headerHeight,l=this.stateManager.getRowHeights(),r=this.stateManager.getData().length;let o=null,a=n;for(let c=0;c<r;c++){const p=l[c];if(s>=a&&s<a+p){o=c;break}if(a+=p,a>s)break}let h=this.stateManager.getDragEndRow();o!==null?h=o:s<n?h=0:h=r-1,h!==this.stateManager.getDragEndRow()&&(this.stateManager.setDragState({isDragging:!0,startCell:e,endRow:h}),this.renderer.draw())}endFillHandleDrag(){if(!this.stateManager.isDraggingFillHandle())return;const t=this.stateManager.getDragEndRow();g("log",this.options.verbose,"Finished dragging fill handle to row",t),this._performFill(),this.stateManager.setDragState({isDragging:!1,startCell:null,endRow:null})}_performFill(){const t=this.stateManager.getDragState();if(!t.isDragging||!t.startCell||t.endRow===null||t.startCell.row===null)return;const e=t.startCell,i=t.endRow,s=e.row,n=e.col;if(n===null||s===null)return;const l=this.stateManager.getCellData(s,n),r=this.stateManager.getSchemaForColumn(n),o=this.stateManager.getColumnKey(n),a=r==null?void 0:r.type;let h=!1;const c=this.stateManager.getData().length,p=i>=s,d=p?s+1:i,u=p?i:s-1,w=[];for(let C=d;C<=u;C++){if(C<0||C>=c)continue;const f=this.stateManager.getSchemaForColumn(n);if(this.stateManager.isCellDisabled(C,n)){g("log",this.options.verbose,`Skipping fill for disabled cell ${C},${n}`);continue}if((f==null?void 0:f.type)!==a){g("log",this.options.verbose,`Skipping fill for row ${C}: Type mismatch (Source: ${a}, Target: ${f==null?void 0:f.type})`);continue}this.stateManager.getCellData(C,n)!==l&&(this.stateManager.updateCellInternal(C,n,l),w.push(C),h=!0)}h&&this.renderer.draw(),w.length>0&&this._batchUpdateCellsAndNotify(w,[o])}_batchUpdateCellsAndNotify(t,e){if(!t||t.length===0)return;const i=[];t.forEach(s=>{this.stateManager.updateDisabledStatesForRow(s),i.push({rowIndex:s,columnKeys:e,data:this.stateManager.getRowData(s)})}),i.length>0&&this.stateManager.callOnCellsUpdate(i)}copy(){var s,n,l;const t=this.stateManager.getActiveCell(),e=this.stateManager.getNormalizedSelectionRange();let i=!1;if(e){const{start:r,end:o}=e,a=[];let h=!0,c;for(let p=r.row;p<=o.row;p++){const d=[];for(let u=r.col;u<=o.col;u++){const w=this.stateManager.getCellData(p,u);d.push(w);const C=(s=this.stateManager.getSchemaForColumn(u))==null?void 0:s.type;p===r.row&&u===r.col?c=C:C!==c&&(h=!1)}a.push(d)}h||g("warn",this.options.verbose,"Copied range contains mixed data types."),i=this.stateManager.setCopiedRange(a,e),g("log",this.options.verbose,`Copied range data [${a.length}x${(n=a[0])==null?void 0:n.length}] from source range [${r.row},${r.col}] -> [${o.row},${o.col}]`)}else if(t&&t.row!==null&&t.col!==null){const{row:r,col:o}=t,a=this.stateManager.getCellData(r,o),h=(l=this.stateManager.getSchemaForColumn(o))==null?void 0:l.type;i=this.stateManager.setCopiedValue(a,h,{...t}),i&&g("log",this.options.verbose,`Copied value: ${a} (Type: ${h}) from cell ${r},${o}`)}return i}paste(){if(this.lastPasteHandledAt&&Date.now()-this.lastPasteHandledAt.getTime()<1e3)return!1;this.lastPasteHandledAt=new Date,g("log",this.options.verbose,"Paste requested by keyboard shortcut");const t=this.stateManager.getActiveCell(),e=this.stateManager.getNormalizedSelectionRange(),i=this.stateManager.getCopiedValue(),s=this.stateManager.getCopiedValueType(),n=this.stateManager.getCopiedRangeData(),l=e,r=!l&&t?t:null;return!l&&!r?(g("log",this.options.verbose,"Paste ignored: No target cell or range selected."),!1):n?(g("log",this.options.verbose,"Pasting range data"),l?this._pasteRangeToRange(l,n):r&&r.row!==null&&r.col!==null?this._pasteRangeFromTopLeft(r,n):!1):i!==void 0?(g("log",this.options.verbose,"Pasting single value"),l?this._pasteSingleValueToRange(l,i,s):r&&r.row!==null&&r.col!==null?this._pasteSingleValue(r,i,s):!1):(g("log",this.options.verbose,"Nothing to paste."),!1)}_pasteSingleValue(t,e,i){if(t.row===null||t.col===null)return!1;const s=t.row,n=t.col,l=this.stateManager.getColumnKey(n),r=this.stateManager.getSchemaForColumn(n);if(this.stateManager.isCellDisabled(s,n))return g("log",this.options.verbose,`Paste cancelled: Target cell ${s},${n} is disabled.`),!1;if((r==null?void 0:r.type)!==i&&e!==null){g("log",this.options.verbose,`Type mismatch (Copied: ${i}, Target: ${r==null?void 0:r.type}) - attempting conversion.`);const h=this._convertValueForTargetType(e,r);if(h===null)return g("log",this.options.verbose,"Paste cancelled: Cannot convert value between types."),!1;e=h}const o=this.stateManager.getCellData(s,n),a=W(e,r,l,this.options.verbose);return"error"in a?(g("log",this.options.verbose,a.error),a.errorType==="required"&&!o?this.stateManager.updateCell(s,`error:${l}`,a.error):this.renderer.setTemporaryError(s,n),!0):(this.stateManager.removeCellValue(s,`error:${l}`),o!==e?(this.stateManager.updateCellInternal(s,n,e),this._batchUpdateCellsAndNotify([s],[l]),g("log",this.options.verbose,`Pasted value ${e} to cell ${s},${n}`),!0):!1)}_pasteSingleValueToRange(t,e,i){let s=!1;const n=[],l=[];for(let r=t.start.row;r<=t.end.row;r++)for(let o=t.start.col;o<=t.end.col;o++){const a=this.stateManager.getColumnKey(o),h=this.stateManager.getSchemaForColumn(o);if(this.stateManager.isCellDisabled(r,o))continue;let c=e;if((h==null?void 0:h.type)!==i&&e!==null&&(c=this._convertValueForTargetType(e,h),c===null))continue;const p=this.stateManager.getCellData(r,o),d=W(c,h,a,this.options.verbose);if("error"in d){g("warn",this.options.verbose,d.error),d.errorType==="required"&&!p?this.stateManager.updateCell(r,`error:${a}`,d.error):this.renderer.setTemporaryError(r,o),s=!0;continue}else this.stateManager.removeCellValue(r,`error:${a}`);p!==c&&(this.stateManager.updateCellInternal(r,o,c),n.push(r),l.push(a),s=!0)}return n.length>0&&this._batchUpdateCellsAndNotify(n,l),s&&g("log",this.options.verbose,`Pasted single value to range [${t.start.row},${t.start.col}] -> [${t.end.row},${t.end.col}]`),s}_convertValueForTargetType(t,e){const i=e==null?void 0:e.type;if(t==null||i===void 0)return null;if(i==="text"||i==="email")return String(t);const s=String(t).trim();if(s==="")return null;switch(i){case"number":const n=parseFloat(s);return isNaN(n)?null:n;case"boolean":if(typeof t=="boolean")return t;const l=s.toLowerCase();return["true","yes","1","y"].includes(l)?!0:["false","no","0","n"].includes(l)?!1:null;case"date":if(t instanceof Date)return t.toISOString().split("T")[0];try{const r=new Date(t);if(!isNaN(r.getTime()))return r.toISOString().split("T")[0]}catch{}return null;case"select":if(e!=null&&e.values){let r=e.values.find(o=>String(o.id)===s);return r||(r=e.values.find(o=>o.name.toLowerCase()===s.toLowerCase())),r?r.id:null}return null;default:return null}}_pasteRangeFromTopLeft(t,e){var p;if(t.row===null||t.col===null||!e||e.length===0)return!1;const i=t.row,s=t.col,n=e.length,l=((p=e[0])==null?void 0:p.length)||0;let r=!1;const o=this.stateManager.getData().length,a=this.stateManager.getColumns().length,h=[],c=new Set;for(let d=0;d<n;d++){const u=i+d;if(u>=o)break;const w=e[d];let C=!1;for(let f=0;f<l;f++){const m=s+f;if(m>=a)break;const S=w[f],b=this.stateManager.getColumnKey(m),v=this.stateManager.getSchemaForColumn(m);if(this.stateManager.isCellDisabled(u,m))continue;let R=S;if(R!==null&&(R=this._convertValueForTargetType(S,v),R===null))continue;const y=this.stateManager.getCellData(u,m),E=W(R,v,b,this.options.verbose);if("error"in E){g("warn",this.options.verbose,E.error),E.errorType==="required"&&!y?this.stateManager.updateCell(u,`error:${b}`,E.error):this.renderer.setTemporaryError(u,m),r=!0;continue}else this.stateManager.removeCellValue(u,`error:${b}`);y!==R&&(this.stateManager.updateCellInternal(u,m,R),C=!0,c.add(b))}C&&(h.push(u),r=!0)}return h.length>0&&(this._batchUpdateCellsAndNotify(h,Array.from(c)),g("log",this.options.verbose,`Pasted range [${n}x${l}] starting at ${i},${s}`)),r}_pasteRangeToRange(t,e){var o;if(!e||e.length===0)return!1;const i=e.length,s=((o=e[0])==null?void 0:o.length)||0;if(s===0)return!1;let n=!1;const l=[],r=new Set;for(let a=t.start.row;a<=t.end.row;a++){let h=!1;for(let c=t.start.col;c<=t.end.col;c++){const p=(a-t.start.row)%i,d=(c-t.start.col)%s,u=e[p][d],w=this.stateManager.getColumnKey(c),C=this.stateManager.getSchemaForColumn(c);if(this.stateManager.isCellDisabled(a,c))continue;let f=u;if(f!==null&&(f=this._convertValueForTargetType(u,C),f===null))continue;const m=this.stateManager.getCellData(a,c),S=W(f,C,w,this.options.verbose);if("error"in S){g("warn",this.options.verbose,S.error),S.errorType==="required"&&!m?this.stateManager.updateCell(a,`error:${w}`,S.error):this.renderer.setTemporaryError(a,c),n=!0;continue}else this.stateManager.removeCellValue(a,`error:${w}`);m!==f&&(this.stateManager.updateCellInternal(a,c,f),h=!0,r.add(w))}h&&(l.push(a),n=!0)}return l.length>0&&(this._batchUpdateCellsAndNotify(l,Array.from(r)),g("log",this.options.verbose,`Pasted range pattern into target range [${t.start.row},${t.start.col}] -> [${t.end.row},${t.end.col}]`)),n}clearCopiedCell(){return this.stateManager.clearCopyState()}deleteSelectedRows(){var n,l;const t=this.stateManager.getSelectedRows();if(t.size===0)return!1;const e=Array.from(t);g("log",this.options.verbose,"Deleting rows:",e);const i=e.map(r=>this.stateManager.getRowData(r)).filter(r=>r);let s=this.stateManager.deleteRows(e);try{(l=(n=this.options).onRowDeleted)==null||l.call(n,i)}catch(r){g("error",this.options.verbose,`Error calling onRowDeleted: ${r}`)}return s>0?(this.clearSelections(),this.stateManager.setActiveCell(null),this.clearCopiedCell(),this.dimensionCalculator.initializeSizes(this.stateManager.getData().length),this.dimensionCalculator.calculateDimensions(this.stateManager.getViewportWidth(),this.stateManager.getViewportHeight()),this.domManager.updateCanvasSize(this.stateManager.getTotalContentWidth(),this.stateManager.getTotalContentHeight()),!0):!1}startSelectionDrag(t){if(t.row===null||t.col===null)return!1;let e=!1;this.stateManager.setDraggingSelection(!0);const i=this.stateManager.setActiveCell(t),s=this.stateManager.setSelectionRange(t,t);e=i||s;let n=!1;return e&&(n=this.clearSelections()),e||n?(g("log",this.options.verbose,`Started selection drag at ${t.row},${t.col}`),!0):!1}updateSelectionDrag(t){if(!this.stateManager.getIsDraggingSelection()||!this.stateManager.getSelectionStartCell()||t.row===null||t.col===null)return!1;const e=this.stateManager.getSelectionEndCell();return(e==null?void 0:e.row)!==t.row||(e==null?void 0:e.col)!==t.col?(g("log",this.options.verbose,`Updating selection drag to ${t.row},${t.col}`),this.stateManager.setSelectionRange(this.stateManager.getSelectionStartCell(),t)):!1}endSelectionDrag(){this.stateManager.getIsDraggingSelection()&&(g("log",this.options.verbose,`Ended selection drag. Final range: ${JSON.stringify(this.stateManager.getNormalizedSelectionRange())}`),this.stateManager.setDraggingSelection(!1))}moveActiveCell(t,e,i=!0){if(!this.editingManager)return g("warn",this.options.verbose,"EditingManager not set, cannot move active cell."),!1;const s=this.stateManager.getActiveCell();if(!s||s.row===null||s.col===null)return!1;let n=s.row,l=s.col;const r=this.stateManager.getData().length,o=this.stateManager.getColumns().length;let a=n+t,h=l+e;if(h>=o?(h=0,a++):h<0&&(h=o-1,a--),a<0||a>=r)return this.editingManager.deactivateEditor(!0),this.stateManager.setActiveCell(null),g("log",this.options.verbose,"Reached grid boundary, deactivating editor."),!0;let c=0;const p=r*o;for(;this.stateManager.isCellDisabled(a,h)&&c<p;)if(c++,a+=t,h+=e,h>=o?(h=0,a++):h<0&&(h=o-1,a--),a<0||a>=r)return this.editingManager.deactivateEditor(!0),this.stateManager.setActiveCell(null),g("warn",this.options.verbose,"Could not find next editable cell in direction."),!0;return c>=p?(g("warn",this.options.verbose,"Max search limit reached while finding next editable cell."),this.editingManager.deactivateEditor(!0),this.stateManager.setActiveCell(null),!0):(this.stateManager.setActiveCell({row:a,col:h}),i&&this.editingManager.activateEditor(a,h),!0)}pasteSingleValueExternal(t,e){if(t.row===null||t.col===null)return!1;const i=this.stateManager.getSchemaForColumn(t.col);return(i==null?void 0:i.type)!=="text"?(g("log",this.options.verbose,`Clipboard paste cancelled: Target cell ${t.row},${t.col} is not type 'text'.`),!1):this._pasteSingleValue(t,e,"text")}pasteRangeFromTopLeftExternal(t,e){var p;if(t.row===null||t.col===null||!e||e.length===0)return!1;const i=t.row,s=t.col,n=e.length,l=((p=e[0])==null?void 0:p.length)||0;let r=!1;const o=this.stateManager.getData().length,a=this.stateManager.getColumns().length,h=[],c=new Set;for(let d=0;d<n;d++){const u=i+d;if(u>=o)break;const w=e[d];let C=!1;for(let f=0;f<l;f++){const m=s+f;if(m>=a)break;const S=w[f],b=this.stateManager.getColumnKey(m),v=this.stateManager.getSchemaForColumn(m);if(this.stateManager.isCellDisabled(u,m))continue;if((v==null?void 0:v.type)!=="text"){g("log",this.options.verbose,`Clipboard paste range: Target cell ${u},${m} is not type 'text'. Skipping.`);continue}const R=this.stateManager.getCellData(u,m),y=W(S,v,b,this.options.verbose);if("error"in y){g("warn",this.options.verbose,y.error),y.errorType==="required"&&!R?this.stateManager.updateCell(u,`error:${b}`,y.error):this.renderer.setTemporaryError(u,m),r=!0;continue}else this.stateManager.removeCellValue(u,`error:${b}`);R!==S&&(this.stateManager.updateCellInternal(u,m,S),C=!0,c.add(b))}C&&(h.push(u),r=!0)}return h.length>0&&(this._batchUpdateCellsAndNotify(h,Array.from(c)),g("log",this.options.verbose,`Pasted external range [${n}x${l}] starting at ${i},${s}`)),r}pasteRangeToRangeExternal(t,e){var o;if(!e||e.length===0)return!1;const i=e.length,s=((o=e[0])==null?void 0:o.length)||0;if(s===0)return!1;let n=!1;const l=[],r=new Set;for(let a=t.start.row;a<=t.end.row;a++){let h=!1;for(let c=t.start.col;c<=t.end.col;c++){const p=(a-t.start.row)%i,d=(c-t.start.col)%s,u=e[p][d],w=this.stateManager.getColumnKey(c),C=this.stateManager.getSchemaForColumn(c);if(this.stateManager.isCellDisabled(a,c))continue;const f=this._convertValueForTargetType(u,C);if(f===null)continue;const m=this.stateManager.getCellData(a,c),S=W(f,C,w,this.options.verbose);if("error"in S){g("warn",this.options.verbose,S.error),S.errorType==="required"&&!m?this.stateManager.updateCell(a,`error:${w}`,S.error):this.renderer.setTemporaryError(a,c),n=!0;continue}else this.stateManager.removeCellValue(a,`error:${w}`);m!==f&&(this.stateManager.updateCellInternal(a,c,f),h=!0,r.add(w))}h&&(l.push(a),n=!0)}return l.length>0&&(this._batchUpdateCellsAndNotify(l,Array.from(r)),g("log",this.options.verbose,`Pasted external range pattern into target range [${t.start.row},${t.start.col}] -> [${t.end.row},${t.end.col}]`)),n}pasteToColumnExternal(t,e){g("log",this.options.verbose,`External paste to entire column ${t}`);const i=this.stateManager.getSchemaForColumn(t),s=this.stateManager.getData();let n=!1;if(e==null)return g("log",this.options.verbose,"No value to paste to column"),!1;const l=this._convertValueForTargetType(e,i),r=[];for(let o=0;o<s.length;o++){if(this.stateManager.isCellDisabled(o,t))continue;this.stateManager.getCellData(o,t)!==l&&(this.stateManager.updateCellInternal(o,t,l),n=!0,r.push(o))}return n&&(this._batchUpdateCellsAndNotify(r,[this.stateManager.getColumnKey(t)]),this.renderer.draw()),n}}class xt{constructor(t,e,i){this.columnWidths=[],this.rowHeights=[],this.scrollTop=0,this.scrollLeft=0,this.viewportWidth=0,this.viewportHeight=0,this.totalContentWidth=0,this.totalContentHeight=0,this.visibleRowStartIndex=0,this.visibleRowEndIndex=0,this.visibleColStartIndex=0,this.visibleColEndIndex=0,this.activeCell=null,this.selectionStartCell=null,this.selectionEndCell=null,this.isDraggingSelection=!1,this.activeEditor=null,this.selectedRows=new Set,this.lastClickedRow=null,this.selectedColumn=null,this.copiedValue=void 0,this.copiedValueType=void 0,this.copiedCell=null,this.copiedRangeData=null,this.copiedSourceRange=null,this.dragState={isDragging:!1,startCell:null,endRow:null},this.resizeColumnState={isResizing:!1,columnIndex:null,startX:null},this.resizeRowState={isResizing:!1,rowIndex:null,startY:null},this.schema=t,this.columns=Object.keys(t),this.data=[],this.options=i}setInitialData(t){this.data=JSON.parse(JSON.stringify(t||[])),this._updateAllDisabledStates()}getData(){return JSON.parse(JSON.stringify(this.data,(t,e)=>{if(!(typeof t=="string"&&t.startsWith(O)))return e}))}setData(t){this.data=JSON.parse(JSON.stringify(t||[])),this._updateAllDisabledStates(),this.resetInteractionState()}clearAllSelections(){this.activeCell=null,this.selectionStartCell=null,this.selectionEndCell=null,this.isDraggingSelection=!1,this.selectedRows=new Set,this.selectedColumn=null,this.lastClickedRow=null,this.copiedValue=void 0,this.copiedValueType=void 0,this.copiedCell=null}updateCellInternal(t,e,i){if(t<0||t>=this.data.length||e<0||e>=this.columns.length){g("warn",this.options.verbose,`updateCellInternal: Invalid coordinates (${t}, ${e})`);return}const s=this.columns[e];this.data[t]||(this.data[t]={}),this.data[t][s]=i}updateCell(t,e,i,s=!1){if(t<0||t>=this.data.length)return g("warn",this.options.verbose,`updateCell: Invalid row index (${t}).`),!1;if(e.includes(":"))return this.data[t][e]=i,!0;if(this.columns.indexOf(e)<0)return g("warn",this.options.verbose,`updateCell: Invalid column key (${e}).`),!1;const l=this.schema[e],r=W(i,l,e,this.options.verbose);if("error"in r){if(g("warn",this.options.verbose,`updateCell: Validation failed for ${e}. Value not set.`),s)throw new J({errorMessage:r.error,rowIndex:t,colKey:e,value:i,schema:l,errorType:r.errorType})}else if(this.data[t]||(this.data[t]={}),e.includes(":")||this.removeCellValue(t,`error:${e}`),this.data[t][e]!==i)return this.data[t][e]=i,this.updateDisabledStatesForRow(t),!0;return!1}removeCellValue(t,e){var s;if(t<0||t>=this.data.length)return g("warn",this.options.verbose,`removeCellValue: Invalid coordinates (${t}, ${e}).`),!1;const i=(s=this.data[t])==null?void 0:s[e];return delete this.data[t][e],!!i}getCellData(t,e){var s;if(t<0||t>=this.data.length||e<0||e>=this.columns.length)return;const i=this.columns[e];return(s=this.data[t])==null?void 0:s[i]}getRowData(t){return this.data[t]}deleteRows(t){let e=0;return t.sort((s,n)=>n-s).forEach(s=>{s>=0&&s<this.data.length&&(this.data.splice(s,1),s<this.rowHeights.length&&this.rowHeights.splice(s,1),e++)}),e>0&&this._updateAllDisabledStates(),e}getSchema(){return this.schema}getColumns(){return this.columns}getColumnKey(t){return this.columns[t]}getSchemaForColumn(t){const e=this.columns[t];return e?this.schema[e]:void 0}getColumnWidths(){return this.columnWidths}setColumnWidths(t){this.columnWidths=t}getRowHeights(){return this.rowHeights}setRowHeights(t){this.rowHeights=t}getTotalContentWidth(){return this.totalContentWidth}getTotalContentHeight(){return this.totalContentHeight}updateViewportSize(t,e){this.viewportWidth=t,this.viewportHeight=e}getViewportWidth(){return this.viewportWidth}getViewportHeight(){return this.viewportHeight}updateTotalContentSize(t,e){this.totalContentWidth=t,this.totalContentHeight=e}updateScroll(t,e){this.scrollTop=t,this.scrollLeft=e}getScrollTop(){return this.scrollTop}getScrollLeft(){return this.scrollLeft}updateVisibleRange(t,e,i,s){this.visibleRowStartIndex=t,this.visibleRowEndIndex=e,this.visibleColStartIndex=i,this.visibleColEndIndex=s}getVisibleRowStartIndex(){return this.visibleRowStartIndex}getVisibleRowEndIndex(){return this.visibleRowEndIndex}getVisibleColStartIndex(){return this.visibleColStartIndex}getVisibleColEndIndex(){return this.visibleColEndIndex}getActiveCell(){return this.activeCell}setActiveCell(t){const e=JSON.stringify(this.activeCell)!==JSON.stringify(t);return e&&(this.activeCell=t),this.options.onCellSelected&&(t!=null&&t.col)&&(t!=null&&t.row)&&setTimeout(()=>{try{this.options.onCellSelected(t==null?void 0:t.row,this.getColumnKey(t==null?void 0:t.col),this.data[t==null?void 0:t.row])}catch{}},0),e}getActiveEditor(){return this.activeEditor}setActiveEditor(t){this.activeEditor=t}getSelectedRows(){return this.selectedRows}setSelectedRows(t,e){const i=JSON.stringify(Array.from(this.selectedRows).sort((o,a)=>o-a)),s=JSON.stringify(Array.from(t).sort((o,a)=>o-a)),n=i!==s,l=this.lastClickedRow!==e,r=n||l;return r&&(this.selectedRows=new Set(t),this.lastClickedRow=e),r}getLastClickedRow(){return this.lastClickedRow}getSelectedColumn(){return this.selectedColumn}setSelectedColumn(t){const e=this.selectedColumn!==t;return e&&(this.selectedColumn=t),e}getCopiedValue(){return this.copiedValue}getCopiedValueType(){return this.copiedValueType}getCopiedCell(){return this.copiedCell}setCopiedValue(t,e,i){const s=JSON.stringify(this.copiedCell)!==JSON.stringify(i),n=this.copiedRangeData!==null,l=this.copiedSourceRange!==null;return this.copiedValue=t,this.copiedValueType=e,this.copiedCell=i,this.copiedRangeData=null,this.copiedSourceRange=null,s||n||l}setCopiedRange(t,e){const i=JSON.stringify(this.copiedRangeData)!==JSON.stringify(t),s=JSON.stringify(this.copiedSourceRange)!==JSON.stringify(e),n=this.copiedCell!==null;return this.copiedRangeData=t,this.copiedSourceRange=e,this.copiedValue=void 0,this.copiedValueType=void 0,this.copiedCell=null,i||s||n}getCopiedRangeData(){return this.copiedRangeData}getCopiedSourceRange(){return this.copiedSourceRange}isCopyActive(){return this.copiedCell!==null||this.copiedRangeData!==null}clearCopyState(){return this.setCopiedValue(void 0,void 0,null)}getDragState(){return this.dragState}setDragState(t){this.dragState=t}isDraggingFillHandle(){return this.dragState.isDragging}getDragStartCell(){return this.dragState.startCell}getDragEndRow(){return this.dragState.endRow}getResizeColumnState(){return this.resizeColumnState}setResizeColumnState(t){this.resizeColumnState=t}getResizeRowState(){return this.resizeRowState}setResizeRowState(t){this.resizeRowState=t}isResizing(){return this.resizeColumnState.isResizing||this.resizeRowState.isResizing}resetInteractionState(){this.activeCell=null,this.selectionStartCell=null,this.selectionEndCell=null,this.isDraggingSelection=!1,this.activeEditor=null,this.selectedRows=new Set,this.selectedColumn=null,this.lastClickedRow=null,this.copiedValue=void 0,this.copiedValueType=void 0,this.copiedCell=null,this.copiedRangeData=null,this.copiedSourceRange=null,this.dragState={isDragging:!1,startCell:null,endRow:null},this.resizeColumnState={isResizing:!1,columnIndex:null,startX:null},this.resizeRowState={isResizing:!1,rowIndex:null,startY:null}}isCellDisabled(t,e){if(t<0||t>=this.data.length||e<0||e>=this.columns.length)return!0;const i=this.columns[e],s=this.data[t];return!!(s!=null&&s[`${O}${i}`])}updateDisabledStatesForRow(t){if(t<0||t>=this.data.length)return!1;const e=this.data[t];if(!e)return!1;let i=!1;return this.columns.forEach(s=>{const n=`${O}${s}`,l=!!e[n],r=this.schema[s],o=r!=null&&r.disabled?r.disabled(e,t):!1;l!==o&&(e[n]=o,i=!0)}),i}callOnCellsUpdate(t){var e,i;(i=(e=this.options).onCellsUpdate)==null||i.call(e,t)}_updateAllDisabledStates(){g("log",this.options.verbose,"Updating all disabled states...");for(let t=0;t<this.data.length;t++)this.updateDisabledStatesForRow(t);g("log",this.options.verbose,"Finished updating all disabled states.")}getSelectionStartCell(){return this.selectionStartCell}getSelectionEndCell(){return this.selectionEndCell}setSelectionRange(t,e){const i=JSON.stringify(this.selectionStartCell)!==JSON.stringify(t),s=JSON.stringify(this.selectionEndCell)!==JSON.stringify(e),n=i||s;return n&&(this.selectionStartCell=t,this.selectionEndCell=e),n}clearSelectionRange(){return this.setSelectionRange(null,null)}getNormalizedSelectionRange(){if(!this.selectionStartCell||!this.selectionEndCell||this.selectionStartCell.row===null||this.selectionStartCell.col===null||this.selectionEndCell.row===null||this.selectionEndCell.col===null)return null;const t=Math.min(this.selectionStartCell.row,this.selectionEndCell.row),e=Math.min(this.selectionStartCell.col,this.selectionEndCell.col),i=Math.max(this.selectionStartCell.row,this.selectionEndCell.row),s=Math.max(this.selectionStartCell.col,this.selectionEndCell.col);return{start:{row:t,col:e},end:{row:i,col:s}}}isMultiCellSelectionActive(){return!!this.selectionStartCell&&!!this.selectionEndCell}setDraggingSelection(t){this.isDraggingSelection=t}getIsDraggingSelection(){return this.isDraggingSelection}addRow(){const t={};this.columns.forEach(i=>{if(i.includes(O))return;const s=this.schema[i];let n=null;if(s)switch(s.type){case"text":case"email":n="";break;case"number":n=0;break;case"boolean":n=!1;break;default:n=null}t[i]=n}),this.data.push(t);const e=this.data.length-1;return this.updateDisabledStatesForRow(e),e}addColumn(t,e){const i=`custom:${t}`;if(this.schema[i])throw new Error(`Column ${t} already exists`);const s=this.columns.length;return this.columns.push(i),this.columnWidths.push(this.options.defaultColumnWidth),this.schema[i]=e,s}removeColumn(t){const e=this.columns[t];this.clearAllSelections(),delete this.schema[e],this.columns.splice(t,1),this.columnWidths.splice(t,1),this.data.forEach(i=>{delete i[e]})}}class Tt{constructor(t,e,i=[],s={}){const n=document.getElementById(t);if(!n)throw new Error(`Container element with ID "${t}" not found.`);this.container=n,this.options={...pt,...s},this.stateManager=new xt(e,i,this.options),this.domManager=new wt(this.container),this.dimensionCalculator=new St(this.options,this.stateManager,this.domManager),this.renderer=new bt(this.domManager.getContext(),this.options,this.stateManager,this.dimensionCalculator),this.interactionManager=new Rt(this.options,this.stateManager,this.renderer,this.dimensionCalculator,this.domManager),this.editingManager=new yt(this.container,this.options,this.stateManager,this.domManager,this.renderer,this.interactionManager),this.eventManager=new vt(this.container,this.editingManager,this.interactionManager,this.stateManager,this.dimensionCalculator,this.renderer,this.options,this.domManager),this.stateManager.setInitialData(i),this.dimensionCalculator.initializeSizes(i.length),this.domManager.setup(this.stateManager.getTotalContentWidth(),this.stateManager.getTotalContentHeight()),this.dimensionCalculator.calculateDimensions(this.container.clientWidth,this.container.clientHeight),this.eventManager.bindEvents(l=>{l.type==="resize"&&this.onDataUpdate()}),this.draw(),g("log",this.options.verbose,"Spreadsheet initialized")}draw(){this.stateManager.updateScroll(this.domManager.getVScrollPosition(),this.domManager.getHScrollPosition()),this.dimensionCalculator.calculateVisibleRange(),this.renderer.draw()}onDataUpdate(t=0,e=0){this.dimensionCalculator.initializeSizes(this.stateManager.getData().length),this.domManager.updateCanvasSize(this.stateManager.getTotalContentWidth(),this.stateManager.getTotalContentHeight()),this.dimensionCalculator.calculateDimensions(this.container.clientWidth,this.container.clientHeight),this.interactionManager.moveScroll(e,t,!0),this.draw()}getData(){return this.stateManager.getData()}setData(t){this.stateManager.setData(t),this.onDataUpdate()}addRow(){const t=this.stateManager.addRow();return this.onDataUpdate(this.container.scrollHeight,0),t}addColumn(t,e){const i=this.stateManager.addColumn(t,e);return this.onDataUpdate(0,this.container.scrollWidth),i}updateCell(t,e,i){let s=!1;try{if(!this.stateManager.updateCell(t,e,i,!0))return;s=!0}catch(n){n instanceof J?(this.stateManager.updateCell(t,`error:${e}`,n.message),s=!0):g("warn",this.options.verbose,n)}s&&this.draw()}getSelectedCell(){const t=this.stateManager.getActiveCell();return!t||!t.row||!t.col?null:{row:t.row,colKey:this.stateManager.getColumnKey(t.col)}}getRow(t){const e=this.stateManager.getRowData(t);return e||null}focus(){this.domManager.focusContainer()}setValueFromCustomEditor(t,e,i){this.focus(),this.editingManager.isEditorActive()&&this.editingManager.deactivateEditor(!1,!0),this.updateCell(t,e,i)}redraw(){this.draw()}}export{Tt as S};
